---
phase: v0.1.9-01-plugin-structure-validation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .claude-plugin/plugin.json
  - hooks/hooks.json
autonomous: true

must_haves:
  truths:
    - "Plugin validates with `claude plugin validate .`"
    - "Local testing works with `claude --plugin-dir ./`"
    - "All /kata:* commands are accessible after plugin load"
  artifacts:
    - path: ".claude-plugin/plugin.json"
      provides: "Plugin manifest with metadata"
      contains: '"name": "kata"'
    - path: "hooks/hooks.json"
      provides: "Hook registration for SessionStart"
      contains: "SessionStart"
  key_links:
    - from: "hooks/hooks.json"
      to: "hooks/kata-check-update.js"
      via: "command reference"
      pattern: "kata-check-update"
---

<objective>
Create Claude Code plugin manifest and hooks configuration for Kata.

Purpose: Transform Kata from npm-installed package to Claude Code plugin format
Output: Valid plugin structure that passes `claude plugin validate .` and loads with `--plugin-dir`
</objective>

<execution_context>
@~/.claude/kata/workflows/execute-plan.md
@~/.claude/kata/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/v0.1.9-01-plugin-structure-validation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create plugin manifest</name>
  <files>.claude-plugin/plugin.json</files>
  <action>
Create `.claude-plugin/` directory and `plugin.json` with:
- name: "kata"
- version: "0.1.6" (matches milestone, not package.json which is 0.1.7)
- description: "Spec-driven development framework for Claude Code. Provides structured workflows for requirements gathering, research, planning, execution, and verification."
- author: { name: "gannonh", url: "https://github.com/gannonh" }
- homepage: "https://github.com/gannonh/kata"
- repository: "https://github.com/gannonh/kata"
- license: "MIT"
- keywords: ["claude", "claude-code", "spec-driven-development", "meta-prompting", "context-engineering", "ai-development"]

Note: Only plugin.json goes in .claude-plugin/. Commands, agents, skills, hooks stay at repo root.
  </action>
  <verify>cat .claude-plugin/plugin.json | jq . (valid JSON with all required fields)</verify>
  <done>plugin.json exists with name, version, description, author fields</done>
</task>

<task type="auto">
  <name>Task 2: Create hooks.json</name>
  <files>hooks/hooks.json</files>
  <action>
Create `hooks/hooks.json` to register Kata's SessionStart hook:
- description: "Kata framework hooks for session management"
- hooks.SessionStart: array with kata-check-update.js command

Use `${CLAUDE_PLUGIN_ROOT}` for script path: "node ${CLAUDE_PLUGIN_ROOT}/hooks/kata-check-update.js"

Important: Do NOT include statusline in hooks.json - that's a user preference, not plugin functionality. The research explicitly notes this.
  </action>
  <verify>cat hooks/hooks.json | jq . (valid JSON with SessionStart hook)</verify>
  <done>hooks.json exists with SessionStart hook referencing kata-check-update.js</done>
</task>

<task type="auto">
  <name>Task 3: Validate plugin structure</name>
  <files></files>
  <action>
Run validation and local testing commands:

1. Run `claude plugin validate .` from repo root
   - Expected: "Plugin validated successfully" or similar success message
   - If errors: fix issues in plugin.json or hooks.json

2. Run `claude --plugin-dir ./` to start Claude Code with local plugin
   - Expected: Claude loads without errors
   - Verify /kata:* commands appear (try `/kata:help` or check `/help`)

3. If validation fails, report specific errors for diagnosis.

Note: The validation command may require Claude Code CLI to be installed. If command not found, document and mark as checkpoint for user to run.
  </action>
  <verify>claude plugin validate . exits with 0; claude --plugin-dir ./ loads commands</verify>
  <done>Plugin validates without errors; /kata:* commands accessible via --plugin-dir</done>
</task>

</tasks>

<verification>
Requirements coverage:
- PLG-01: plugin.json with name, version, description, author (Task 1)
- PLG-02: commands/ directory exists (already present - 27 commands)
- PLG-03: agents/ directory exists (already present - 12 agents)
- PLG-04: skills/ directory exists (already present - 27 skills)
- PLG-05: hooks/hooks.json exists (Task 2)
- VAL-01: claude plugin validate . passes (Task 3)
- VAL-02: claude --plugin-dir ./ works (Task 3)
</verification>

<success_criteria>
- [ ] .claude-plugin/plugin.json exists with required metadata
- [ ] hooks/hooks.json exists with SessionStart hook
- [ ] `claude plugin validate .` passes
- [ ] `claude --plugin-dir ./` loads plugin and shows /kata:* commands
</success_criteria>

<output>
After completion, create `.planning/phases/v0.1.9-01-plugin-structure-validation/01-01-SUMMARY.md`
</output>
