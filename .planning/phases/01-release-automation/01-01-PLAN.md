---
phase: 01-release-automation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/completing-milestones/references/version-detector.md
  - skills/completing-milestones/references/changelog-generator.md
autonomous: true

must_haves:
  truths:
    - "Version bump type (major/minor/patch) can be determined from conventional commits"
    - "Changelog entries can be generated from commit history"
    - "Breaking changes are detected from commit messages"
  artifacts:
    - path: "skills/completing-milestones/references/version-detector.md"
      provides: "Version bump detection logic"
      min_lines: 50
      contains: "detect_version_bump"
    - path: "skills/completing-milestones/references/changelog-generator.md"
      provides: "Changelog generation logic"
      min_lines: 80
      contains: "generate_changelog_entry"
  key_links:
    - from: "version-detector.md"
      to: "git log"
      via: "commit parsing"
      pattern: "git log.*oneline"
    - from: "changelog-generator.md"
      to: "Keep a Changelog format"
      via: "markdown generation"
      pattern: "## \\[.*\\]"
---

<objective>
Create reference files for version detection and changelog generation that will be used by the completing-milestones skill.

Purpose: Provide reusable bash patterns for determining semantic version bumps from conventional commits and generating changelog entries in Keep a Changelog format.

Output: Two reference files in skills/completing-milestones/references/ that can be loaded by Claude during milestone completion.
</objective>

<execution_context>
<!-- Executor agent has built-in instructions for plan execution and summary creation -->
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-release-automation/01-RESEARCH.md

# Existing skill structure
@skills/completing-milestones/SKILL.md
@skills/completing-milestones/references/milestone-complete.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create version-detector.md reference</name>
  <files>skills/completing-milestones/references/version-detector.md</files>
  <action>
Create a reference file that provides version bump detection logic for the completing-milestones skill.

Include:
1. **Purpose section** — Explain this detects semantic version bump type from conventional commits
2. **Algorithm section** — Document the detection logic:
   - BREAKING CHANGE or `!` suffix → major
   - `feat:` commits → minor
   - `fix:` commits → patch
   - Only docs/chore/refactor → none (prompt for confirmation)
3. **Bash functions** — Provide copy-paste ready functions:
   - `get_last_tag()` — Get most recent version tag
   - `get_commits_since_tag()` — Get commits since last release
   - `categorize_commits()` — Sort commits by type (breaking, feat, fix, other)
   - `detect_version_bump()` — Return "major", "minor", "patch", or "none"
   - `calculate_next_version()` — Given current version and bump type, return new version
4. **Examples section** — Show example commit lists and expected bump types
5. **Edge cases** — Handle: no tags exist, only non-release commits, pre-release versions

Use patterns from research: grep -E for commit type extraction, IFS for version parsing.

Do NOT use external tools (semantic-release, conventional-changelog). Pure bash + git.
  </action>
  <verify>
File exists at skills/completing-milestones/references/version-detector.md with:
- detect_version_bump function
- calculate_next_version function
- Example usage section
  </verify>
  <done>
Reference file provides complete version detection logic that can be used during milestone completion.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create changelog-generator.md reference</name>
  <files>skills/completing-milestones/references/changelog-generator.md</files>
  <action>
Create a reference file that provides changelog generation logic for the completing-milestones skill.

Include:
1. **Purpose section** — Explain this generates changelog entries from conventional commits in Keep a Changelog format
2. **Format section** — Document the output format:
   ```markdown
   ## [X.Y.Z] - YYYY-MM-DD

   ### Added
   - Feature description (from feat commits)

   ### Fixed
   - Bug fix description (from fix commits)

   ### Changed
   - Change description (from refactor/perf/docs commits)

   ### Breaking Changes
   - Breaking change description (from BREAKING CHANGE commits)
   ```
3. **Bash functions** — Provide copy-paste ready functions:
   - `extract_commit_description()` — Strip type prefix from commit message
   - `format_commits_as_list()` — Convert commit array to markdown list
   - `generate_changelog_entry()` — Full entry with version, date, categorized commits
   - `prepend_to_changelog()` — Insert new entry after CHANGELOG.md header
4. **Human review guidance** — Explain that generated entries are suggestions, not final
5. **Examples section** — Show sample input commits and output changelog entry

Keep a Changelog format reference: https://keepachangelog.com

Do NOT auto-write to CHANGELOG.md. Generate as suggestion for human approval.
  </action>
  <verify>
File exists at skills/completing-milestones/references/changelog-generator.md with:
- generate_changelog_entry function
- Keep a Changelog format sections (Added, Fixed, Changed)
- Human review guidance
  </verify>
  <done>
Reference file provides complete changelog generation logic with human review gate.
  </done>
</task>

</tasks>

<verification>
After completing both tasks:
1. Both reference files exist in skills/completing-milestones/references/
2. version-detector.md contains detect_version_bump and calculate_next_version functions
3. changelog-generator.md contains generate_changelog_entry function
4. Both files use pure bash + git (no external dependencies)
5. Both files follow existing Kata reference file patterns (purpose, functions, examples)
</verification>

<success_criteria>
- REL-01 partially satisfied: Changelog generation logic exists (integration in Plan 02)
- REL-02 partially satisfied: Version detection logic exists (integration in Plan 02)
- Reference files are self-contained and well-documented
- Functions are copy-paste ready for use in skill workflow
</success_criteria>

<output>
After completion, create `.planning/phases/01-release-automation/01-01-SUMMARY.md`
</output>
