---
phase: 01.3-phase-discuss-skill
plan: 02
type: execute
wave: 2
depends_on: [01.3-01]
files_modified:
  - tests/skills/kata-discussing-phase-context.test.js
autonomous: true

must_haves:
  truths:
    - "Test file exists for skill trigger verification"
    - "Test verifies 'discuss phase N' triggers skill"
    - "Test uses established test harness patterns"
    - "npm test passes with new test included"
  artifacts:
    - path: "tests/skills/kata-discussing-phase-context.test.js"
      provides: "Skill trigger verification tests"
      contains: "describe('kata-discussing-phase-context"
  key_links:
    - from: "tests/skills/kata-discussing-phase-context.test.js"
      to: "skills/kata-discussing-phase-context/SKILL.md"
      via: "skill installation in beforeEach"
      pattern: "cpSync.*kata-discussing-phase-context"
---

<objective>
Create test file for the `kata-discussing-phase-context` skill to verify it triggers correctly on natural language prompts.

Purpose: Ensure the skill is discoverable and invokes properly when users say "discuss phase N" or related phrases.

Output: Test file following established test harness patterns, passing with `npm test`.
</objective>

<execution_context>
@/Users/gannonhall/dev/oss/kata/kata/workflows/execute-plan.md
@/Users/gannonhall/dev/oss/kata/kata/templates/summary.md
</execution_context>

<context>
**Test Pattern Reference:**
@/Users/gannonhall/dev/oss/kata/tests/skills/kata-researching-phases.test.js

**Test Harness:**
@/Users/gannonhall/dev/oss/kata/tests/harness/claude-cli.js
@/Users/gannonhall/dev/oss/kata/tests/harness/assertions.js

**Project Context:**
@/Users/gannonhall/dev/oss/kata/.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create skill test file</name>
  <files>tests/skills/kata-discussing-phase-context.test.js</files>
  <action>
Create test file following the pattern from `kata-researching-phases.test.js`:

1. **Imports:** node:test (describe, it, beforeEach, afterEach), fs/os/path utilities, harness modules

2. **Setup:**
   - Create isolated test directory in beforeEach
   - Copy kata-project fixture
   - Install kata-discussing-phase-context skill to test project's .claude/skills/

3. **Teardown:**
   - Remove test directory in afterEach

4. **Test Cases:**
   - "triggers skill on 'discuss phase 1' prompt"
   - "triggers skill on 'gather context for phase 1' prompt"
   - "triggers skill on 'what should phase 1 look like' prompt"

Each test should:
- Call invokeClaude with prompt
- Use maxBudget: 2.00 and timeout: 180000 (3 min)
- Assert no error
- Assert skill invoked (num_turns > 1)

Use the exact same structure as kata-researching-phases.test.js but for the new skill.
  </action>
  <verify>
    - File exists at tests/skills/kata-discussing-phase-context.test.js
    - Contains describe('kata-discussing-phase-context skill'
    - Contains at least 2 test cases
    - npm test runs without syntax errors
  </verify>
  <done>Test file created with trigger verification tests following established patterns</done>
</task>

<task type="auto">
  <name>Task 2: Verify skill installation and test execution</name>
  <files>N/A (verification only)</files>
  <action>
1. Run `node bin/install.js --local` to install skill locally

2. Verify skill appears in .claude/skills/:
   ```bash
   ls -la .claude/skills/ | grep discussing
   ```

3. Run full test suite to ensure no regressions:
   ```bash
   npm test
   ```

4. Run single skill test to verify it passes:
   ```bash
   npm run test:skill -- tests/skills/kata-discussing-phase-context.test.js
   ```

If tests fail due to skill not triggering, check:
- Frontmatter description has exhaustive trigger phrases
- Skill name matches test expectations
  </action>
  <verify>
    - .claude/skills/kata-discussing-phase-context/ exists after install
    - npm test passes (no regressions)
    - Single skill test runs and shows skill invocation
  </verify>
  <done>Skill installs correctly and test verifies trigger works</done>
</task>

</tasks>

<verification>
```bash
# Install skill locally
node bin/install.js --local

# Verify skill installed
ls -la .claude/skills/kata-discussing-phase-context/

# Run all tests
npm test

# Run single skill test
npm run test:skill -- tests/skills/kata-discussing-phase-context.test.js
```
</verification>

<success_criteria>
- [ ] tests/skills/kata-discussing-phase-context.test.js exists
- [ ] Test file follows established patterns (beforeEach/afterEach, fixture copy, skill install)
- [ ] Test cases cover multiple trigger phrases
- [ ] Skill installs via `node bin/install.js --local`
- [ ] npm test passes (no regressions)
- [ ] Single skill test executes and verifies trigger
</success_criteria>

<output>
After completion, create `.planning/phases/01.3-phase-discuss-skill/01.3-02-SUMMARY.md`
</output>
