---
phase: 02-create-kata-slash-commands
plan: 07
type: execute
wave: 5
depends_on: ["02-06"]
files_modified:
  - bin/install.js
  - README.md
  - CLAUDE.md
  - skills/kata-starting-project-news/SKILL.md
  - skills/kata-manageing-milestones/SKILL.md
  - skills/kata-managing-project-roadmap/SKILL.md
  - skills/kata-discussing-phase-context/SKILL.md
  - skills/kata-researching-phases/SKILL.md
  - skills/kata-planning-phases/SKILL.md
  - skills/kata-executing-project-phases/SKILL.md
  - skills/kata-verifying-work-outcomes-and-user-acceptance-testing/SKILL.md
  - skills/kata-providing-progress-and-status-updates/SKILL.md
  - skills/kata-managing-todos/SKILL.md
  - skills/kata-debugging-kata-workflow-issues/SKILL.md
  - skills/kata-updating-to-latest-version/SKILL.md
  - skills/kata-executing-task-executes/SKILL.md
  - skills/kata-showing-available-commands-and-usage-guides/SKILL.md
autonomous: true

must_haves:
  truths:
    - "Installation includes commands/kata/ directory"
    - "README documents available /kata: commands"
    - "CLAUDE.md reflects command-based invocation alongside skills"
    - "NextUp tables show /kata:command-name as explicit invocation"
  artifacts:
    - path: "bin/install.js"
      provides: "Installer with commands support"
      contains: "commands/kata"
    - path: "README.md"
      provides: "Command reference documentation"
      contains: "/kata:"
    - path: "CLAUDE.md"
      provides: "Updated workflow documentation"
      contains: "/kata:"
  key_links:
    - from: "bin/install.js"
      to: "commands/kata/"
      via: "Copy during installation"
      pattern: "commands"
---

<objective>
Update installer to include commands, update README with command reference, update CLAUDE.md with command documentation, and update NextUp tables in all skill SKILL.md files.

Purpose: Complete the slash command integration by enabling installation, documentation, and updating skill output to reference commands
Output: Updated bin/install.js, README.md, CLAUDE.md, and all 14 skill SKILL.md files
</objective>

<execution_context>
@~/.claude/kata/workflows/execute-plan.md
@~/.claude/kata/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-create-kata-slash-commands/02-CONTEXT.md

# Reference current files
@bin/install.js
@README.md
@CLAUDE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update installer to include commands</name>
  <files>bin/install.js</files>
  <action>
Update bin/install.js to:

1. **Remove orphaned directory entry** - Remove `'commands/kata'` from orphanedDirs array (line ~170) since we're re-adding commands

2. **Add commands copying** - Add section after skills copying to copy commands:

```javascript
// Copy commands to ~/.claude/commands (slash commands for explicit invocation)
const commandsSrc = path.join(src, 'commands');
if (fs.existsSync(commandsSrc)) {
  const commandsDest = path.join(claudeDir, 'commands');

  // Remove old kata commands before copying new ones
  const kataCommandsDest = path.join(commandsDest, 'kata');
  if (fs.existsSync(kataCommandsDest)) {
    fs.rmSync(kataCommandsDest, { recursive: true });
  }

  // Copy commands/kata directory with path replacement
  const kataCommandsSrc = path.join(commandsSrc, 'kata');
  if (fs.existsSync(kataCommandsSrc)) {
    copyWithPathReplacement(kataCommandsSrc, kataCommandsDest, pathPrefix);
  }

  if (verifyInstalled(kataCommandsDest, 'commands')) {
    console.log(`  ${green}✓${reset} Installed commands`);
  } else {
    failures.push('commands');
  }
}
```

3. **Update verification** - Add commands to the installation summary if desired
  </action>
  <verify>
```bash
# Check orphanedDirs doesn't include commands/kata
grep -A5 "orphanedDirs" bin/install.js

# Check commands copying section exists
grep -A10 "Copy commands" bin/install.js
```
  </verify>
  <done>Installer copies commands/kata/ directory during installation</done>
</task>

<task type="auto">
  <name>Task 2: Update README with command reference</name>
  <files>README.md</files>
  <action>
Add a "Slash Commands" section to README.md documenting all 25 commands.

**Section structure:**
```markdown
## Slash Commands

Kata provides explicit slash commands for deterministic invocation:

### Project & Milestones
| Command                    | Description                    |
| -------------------------- | ------------------------------ |
| `/kata:project-new`        | Start a new Kata project       |
| `/kata:project-status`     | Show project progress          |
| `/kata:milestone-new`      | Create a new milestone         |
| `/kata:milestone-complete` | Complete and archive milestone |
| `/kata:milestone-audit`    | Audit milestone coverage       |

### Roadmap
| Command                   | Description           |
| ------------------------- | --------------------- |
| `/kata:phase-add`         | Add phase to roadmap  |
| `/kata:phase-insert`      | Insert urgent phase   |
| `/kata:phase-remove`      | Remove future phase   |
| `/kata:roadmap-plan-gaps` | Analyze coverage gaps |

### Research & Planning
| Command                   | Description                   |
| ------------------------- | ----------------------------- |
| `/kata:phase-discuss`     | Gather implementation context |
| `/kata:phase-research`    | Research phase domain         |
| `/kata:phase-assumptions` | List phase assumptions        |
| `/kata:phase-plan`        | Create PLAN.md files          |

### Execution & Verification
| Command               | Description                   |
| --------------------- | ----------------------------- |
| `/kata:phase-execute` | Execute phase plans           |
| `/kata:work-verify`   | Verify built work             |
| `/kata:task-execute`  | Quick task with atomic commit |

### Session & Utilities
| Command                | Description             |
| ---------------------- | ----------------------- |
| `/kata:work-pause`     | Pause and save state    |
| `/kata:work-resume`    | Resume from saved state |
| `/kata:codebase-map`   | Map codebase structure  |
| `/kata:todos-add`      | Capture a todo          |
| `/kata:todo-check`     | Review pending todos    |
| `/kata:workflow-debug` | Debug Kata issues       |
| `/kata:help`           | Show command reference  |
| `/kata:update`         | Check for updates       |
| `/kata:whats-new`      | Show changelog          |
```

Place this section after the existing "Usage" section.
  </action>
  <verify>
```bash
# Check section exists
grep -A5 "## Slash Commands" README.md

# Check some commands documented
grep "/kata:phase-plan" README.md
grep "/kata:help" README.md
```
  </verify>
  <done>README includes complete command reference</done>
</task>

<task type="auto">
  <name>Task 3: Update CLAUDE.md with command documentation</name>
  <files>CLAUDE.md</files>
  <action>
Update CLAUDE.md to reflect the command-based invocation model:

1. **Update "Skills vs Commands" section** to clarify:
   - Skills: Autonomous invocation from natural language
   - Commands: Explicit invocation with `/kata:command-name`
   - Both delegate to the same underlying workflows

2. **Update workflow examples** to show both patterns:
   ```markdown
   **Common workflow when working on Kata:**
   1. Check progress: "What's the status?" or `/kata:project-status`
   2. Plan phase: "Plan phase [N]" or `/kata:phase-plan [N]`
   3. Execute: "Execute phase [N]" or `/kata:phase-execute [N]`
   4. Verify: "Verify phase [N]" or `/kata:work-verify [N]`
   ```

3. **Add note about user-invocable: false** explaining skills are not directly invocable via `/skill-name` but work through commands or natural language.

4. **Update Development Commands section** to include:
   ```markdown
   # Verify commands installed
   ls ~/.claude/commands/kata/  # global
   ls .claude/commands/kata/    # local
   ```
  </action>
  <verify>
```bash
# Check updates
grep "/kata:project-status" CLAUDE.md
grep "user-invocable" CLAUDE.md
grep "commands/kata" CLAUDE.md
```
  </verify>
  <done>CLAUDE.md reflects command-based invocation model</done>
</task>

<task type="auto">
  <name>Task 4: Update NextUp tables in all skill SKILL.md files</name>
  <files>skills/kata-starting-project-news/SKILL.md, skills/kata-manageing-milestones/SKILL.md, skills/kata-managing-project-roadmap/SKILL.md, skills/kata-discussing-phase-context/SKILL.md, skills/kata-researching-phases/SKILL.md, skills/kata-planning-phases/SKILL.md, skills/kata-executing-project-phases/SKILL.md, skills/kata-verifying-work-outcomes-and-user-acceptance-testing/SKILL.md, skills/kata-providing-progress-and-status-updates/SKILL.md, skills/kata-managing-todos/SKILL.md, skills/kata-debugging-kata-workflow-issues/SKILL.md, skills/kata-updating-to-latest-version/SKILL.md, skills/kata-executing-task-executes/SKILL.md, skills/kata-showing-available-commands-and-usage-guides/SKILL.md</files>
  <action>
Update the "Next Action" tables in all skill SKILL.md files to show `/kata:command-name` format in the "Explicit Command" column instead of `/kata-skill-name`.

**Mapping (skill -> command):**
| Skill                                                    | Command                                                                          |
| -------------------------------------------------------- | -------------------------------------------------------------------------------- |
| kata-starting-project-news                               | /kata:project-new                                                                |
| kata-manageing-milestones                                | /kata:milestone-new, /kata:milestone-complete, /kata:milestone-audit             |
| kata-managing-project-roadmap                            | /kata:phase-add, /kata:phase-insert, /kata:phase-remove, /kata:roadmap-plan-gaps |
| kata-discussing-phase-context                            | /kata:phase-discuss                                                              |
| kata-researching-phases                                  | /kata:phase-research, /kata:phase-assumptions                                    |
| kata-planning-phases                                     | /kata:phase-plan                                                                 |
| kata-executing-project-phases                            | /kata:phase-execute                                                              |
| kata-verifying-work-outcomes-and-user-acceptance-testing | /kata:work-verify                                                                |
| kata-providing-progress-and-status-updates               | /kata:project-status, /kata:work-pause, /kata:work-resume, /kata:codebase-map    |
| kata-managing-todos                                      | /kata:todos-add, /kata:todo-check                                                |
| kata-debugging-kata-workflow-issues                      | /kata:workflow-debug                                                             |
| kata-updating-to-latest-version                          | /kata:update, /kata:whats-new                                                    |
| kata-executing-task-executes                             | /kata:task-execute                                                               |
| kata-showing-available-commands-and-usage-guides         | /kata:help                                                                       |

**Before (example from kata-planning-phases):**
```markdown
| Action                  | Natural Trigger     | Explicit Command                 |
| ----------------------- | ------------------- | -------------------------------- |
| ⭐ **Execute the phase** | "Execute phase {X}" | `/kata-executing-project-phases` |
```

**After:**
```markdown
| Action                  | Natural Trigger     | Explicit Command      |
| ----------------------- | ------------------- | --------------------- |
| ⭐ **Execute the phase** | "Execute phase {X}" | `/kata:phase-execute` |
```

For each skill:
1. Read the SKILL.md file
2. Find all "Next Action" tables with "Explicit Command" columns
3. Replace `/kata-skill-name` with the corresponding `/kata:command-name`
4. Write the updated file
  </action>
  <verify>
```bash
# Verify no old-style explicit commands remain
grep -r "/kata-" skills/kata-*/SKILL.md | grep "Explicit Command" || echo "OK: No old-style commands"

# Verify new-style commands present
grep -r "/kata:" skills/kata-*/SKILL.md | grep -c "Explicit Command"
```
  </verify>
  <done>All skill NextUp tables show /kata:command-name format</done>
</task>

</tasks>

<verification>
All infrastructure updates complete:

```bash
# Verify installer
node bin/install.js --local 2>&1 | grep -i command

# Verify README
grep -c "/kata:" README.md  # Should be 25+

# Verify CLAUDE.md
grep "/kata:" CLAUDE.md | head -5

# Verify NextUp tables updated
grep -r "Explicit Command" skills/kata-*/SKILL.md | grep -v "/kata:" | wc -l  # Should be 0
```
</verification>

<success_criteria>
- [ ] bin/install.js copies commands/kata/ directory
- [ ] bin/install.js no longer marks commands/kata as orphaned
- [ ] README.md has "Slash Commands" section with all 25 commands
- [ ] CLAUDE.md updated with command invocation patterns
- [ ] CLAUDE.md documents user-invocable: false behavior
- [ ] All 14 skill SKILL.md NextUp tables show /kata:command-name format
</success_criteria>

<output>
After completion, create `.planning/phases/02-create-kata-slash-commands/02-07-SUMMARY.md`
</output>
