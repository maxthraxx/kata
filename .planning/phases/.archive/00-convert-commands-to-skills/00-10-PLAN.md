---
phase: 00-convert-commands-to-skills
plan: 10
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/kata-execution/SKILL.md
  - skills/kata-execution/references/summary-creation.md
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "kata-executor sub-agents create SUMMARY.md after completing tasks"
    - "kata-executor sub-agents make atomic commits per task"
    - "Execution skill prompt includes explicit SUMMARY and commit instructions"
  artifacts:
    - path: "skills/kata-execution/SKILL.md"
      provides: "Sub-agent prompt with explicit SUMMARY and commit requirements"
      contains: "create_summary|atomic commit"
    - path: "skills/kata-execution/references/summary-creation.md"
      provides: "Detailed SUMMARY.md creation guidance for sub-agents"
      min_lines: 50
  key_links:
    - from: "skills/kata-execution/SKILL.md"
      to: "skills/kata-execution/references/summary-creation.md"
      via: "@-reference in sub-agent prompt"
      pattern: "@\\./references/summary-creation\\.md"
---

<objective>
Fix kata-execution skill to ensure sub-agents create SUMMARY.md files and make atomic commits.

Purpose: UAT found that kata-execution skill builds code correctly but fails to create SUMMARY.md files or make atomic commits. The sub-agent prompt is missing explicit instructions for these critical post-execution steps.

Output: Updated SKILL.md with explicit SUMMARY/commit instructions in sub-agent prompt, plus new reference document for SUMMARY creation.
</objective>

<execution_context>
@./.claude/kata/workflows/execute-plan.md
@./.claude/kata/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/00-convert-commands-to-skills/00-UAT.md

**Gap being closed:**
```yaml
- truth: "kata-execution creates SUMMARY.md files and makes atomic commits"
  status: failed
  reason: "Code built and works (32 tests pass), but no SUMMARY.md files created and no atomic commits made"
  missing:
    - "SUMMARY.md creation after each plan completion"
    - "Atomic commits per task with proper commit messages"
    - "Git add/commit workflow during execution"
```
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create summary-creation reference document</name>
  <files>skills/kata-execution/references/summary-creation.md</files>
  <action>
Create new reference document that provides detailed guidance for SUMMARY.md creation.

Include:
1. File location pattern: `.planning/phases/{phase-dir}/{phase}-{plan}-SUMMARY.md`
2. Frontmatter fields to populate (phase, plan, subsystem, requires, provides, affects, tech-stack, key-files, duration, completed)
3. One-liner requirement: substantive not vague ("JWT auth with refresh rotation" not "Authentication implemented")
4. Sections to include: Accomplishments, Files Modified, Decisions Made, Deviations, Task Commits, Next Step
5. Performance data: Duration, Started, Completed timestamps
6. Example SUMMARY.md structure

Model after the create_summary step in execute-plan.md workflow (lines 1320-1377).
  </action>
  <verify>File exists at skills/kata-execution/references/summary-creation.md with >50 lines</verify>
  <done>Reference document provides complete SUMMARY.md creation guidance</done>
</task>

<task type="auto">
  <name>Task 2: Update kata-executor sub-agent prompt in SKILL.md</name>
  <files>skills/kata-execution/SKILL.md</files>
  <action>
Update the Task tool prompt in Step 5 (Execute Waves) to include explicit instructions for:

1. Atomic commits per task:
   - After each task completion, stage files individually (NEVER git add .)
   - Commit with format: `{type}({phase}-{plan}): {task description}`
   - Record commit hash for SUMMARY documentation

2. SUMMARY.md creation:
   - Add @-reference to `@./references/summary-creation.md` in execution_context
   - Add explicit success criteria: "SUMMARY.md created in phase directory"
   - Include SUMMARY.md path in report back requirements

3. Update the prompt template (around line 135-161) to include:
```
<execution_context>
@./references/deviation-rules.md
@./references/checkpoint-protocol.md
@./references/tdd-execution.md
@./references/commit-protocol.md
@./references/summary-creation.md
</execution_context>

<commit_requirements>
After each task:
1. Stage modified files individually (git add path/to/file.ts)
2. Commit: git commit -m "{type}({phase}-{plan}): {task description}"
3. Record commit hash for SUMMARY

NEVER use: git add . or git add -A
</commit_requirements>

<summary_requirements>
After all tasks complete:
1. Create SUMMARY.md at .planning/phases/{phase-dir}/{phase}-{plan}-SUMMARY.md
2. Include all required frontmatter fields
3. Document task commits, accomplishments, deviations
4. Substantive one-liner (not "Phase complete")
</summary_requirements>

<success_criteria>
- [ ] All tasks executed
- [ ] Each task committed individually
- [ ] SUMMARY.md created in plan directory
- [ ] STATE.md updated with position and decisions
</success_criteria>
```

4. Update report back requirements to include SUMMARY path and commit hashes.
  </action>
  <verify>grep -E "@\./references/summary-creation|SUMMARY\.md created|commit individually" skills/kata-execution/SKILL.md returns matches</verify>
  <done>Sub-agent prompt explicitly requires SUMMARY creation and atomic commits</done>
</task>

</tasks>

<verification>
- [ ] skills/kata-execution/references/summary-creation.md exists with detailed guidance
- [ ] SKILL.md sub-agent prompt includes @./references/summary-creation.md
- [ ] SKILL.md sub-agent prompt includes explicit commit requirements
- [ ] SKILL.md success criteria includes SUMMARY.md creation
</verification>

<success_criteria>
kata-executor sub-agents now have explicit instructions to:
1. Make atomic commits per task with proper format
2. Create SUMMARY.md with required structure
3. Report back with SUMMARY path and commit hashes
</success_criteria>

<output>
After completion, create `.planning/phases/00-convert-commands-to-skills/00-10-SUMMARY.md`
</output>
