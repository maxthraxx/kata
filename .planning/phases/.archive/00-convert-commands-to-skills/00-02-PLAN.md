---
phase: 00-convert-commands-to-skills
plan: 02
type: execute
wave: 2
depends_on: ["00-01"]
files_modified:
  - skills/kata-execution/SKILL.md
  - skills/kata-execution/references/deviation-rules.md
  - skills/kata-execution/references/checkpoint-protocol.md
  - skills/kata-execution/references/tdd-execution.md
  - skills/kata-execution/references/commit-protocol.md
autonomous: true

must_haves:
  truths:
    - "User can invoke /kata-execution skill from natural language"
    - "Skill spawns kata-executor sub-agents via Task tool"
    - "Skill handles wave-based parallel execution"
  artifacts:
    - path: "skills/kata-execution/SKILL.md"
      provides: "Plan execution orchestrator skill"
      max_lines: 500
    - path: "skills/kata-execution/references/deviation-rules.md"
      provides: "Automatic deviation handling rules"
    - path: "skills/kata-execution/references/checkpoint-protocol.md"
      provides: "Checkpoint types and return formats"
  key_links:
    - from: "skills/kata-execution/SKILL.md"
      to: "agents/kata-executor.md"
      via: "Task tool spawn"
      pattern: "Task.*kata-executor"
---

<objective>
Create the kata-execution skill for plan execution.

Purpose: Handles executing PLAN.md files, spawning kata-executor sub-agents for each plan, managing waves of parallel execution, deviation handling, and checkpoint pauses.

Output: skills/kata-execution/ directory with SKILL.md and references/
</objective>

<execution_context>
@~/.claude/kata/workflows/execute-plan.md
@~/.claude/kata/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/00-convert-commands-to-skills/00-RESEARCH.md

# Skill-building methodology
@~/.claude/skills/building-claude-code-skills/SKILL.md
@~/.claude/skills/building-claude-code-skills/converting-slash-commands-to-skills.md

# Current implementation to extract workflow from
@commands/kata/phase-execute.md
@agents/kata-executor.md
@kata/workflows/phase-execute.md
@kata/workflows/execute-plan.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create kata-execution skill with references</name>
  <files>
    skills/kata-execution/SKILL.md
    skills/kata-execution/references/deviation-rules.md
    skills/kata-execution/references/checkpoint-protocol.md
    skills/kata-execution/references/tdd-execution.md
    skills/kata-execution/references/commit-protocol.md
  </files>
  <action>
Create the kata-execution skill following /building-claude-code-skills methodology:

1. Create skills/kata-execution/SKILL.md:
   - Frontmatter: name (kata-execution), description (trigger-focused, 3rd person)
   - Description includes: "execute phase", "run plans", "execute PLAN.md", "handle deviations", "checkpoint", "create summary"
   - NO allowed-tools, model, agent, context fields
   - Core workflow (~350 lines max):
     * Extract phase number from natural language context
     * Load project state and validate phase plans exist
     * Group plans by wave from frontmatter
     * For each wave:
       - Spawn kata-executor sub-agents in parallel for each plan
       - Wait for all wave executors to complete
       - Handle checkpoint returns (pause and prompt user)
       - Handle deviation returns
     * Update STATE.md after phase completion
     * Display phase completion summary
   - Reference supporting files with relative paths

2. Create references/deviation-rules.md:
   - Rule 1: Auto-fix obvious bugs
   - Rule 2: Auto-add critical missing functionality
   - Rule 3: Auto-fix blockers
   - Rule 4: Ask about architectural changes
   - Decision tree for deviation handling
   - Examples of each rule application

3. Create references/checkpoint-protocol.md:
   - Checkpoint types (human-verify, decision, human-action)
   - Return formats for each type
   - Gate handling (blocking vs non-blocking)
   - User communication patterns
   - Resume signals

4. Create references/tdd-execution.md:
   - RED-GREEN-REFACTOR cycle
   - TDD plan detection from frontmatter
   - Commit patterns for each phase
   - Context budget for TDD plans (~40%)

5. Create references/commit-protocol.md:
   - Commit message format
   - Types (feat, fix, test, refactor, docs, chore)
   - Stage files individually (never git add .)
   - Capture hash for SUMMARY.md
   - Co-Authored-By line

Extract content from:
- agents/kata-executor.md (has deviation rules, checkpoint handling)
- kata/workflows/phase-execute.md (has wave orchestration)
- kata/workflows/execute-plan.md (has task execution, commit protocol)
  </action>
  <verify>
    - ls skills/kata-execution/ shows SKILL.md and references/ directory
    - wc -l skills/kata-execution/SKILL.md shows less than 500 lines
    - grep "name: kata-execution" skills/kata-execution/SKILL.md returns match
    - grep "Task" skills/kata-execution/SKILL.md shows sub-agent spawning
    - ls skills/kata-execution/references/ shows 4 files
  </verify>
  <done>
    - SKILL.md exists with proper frontmatter (name, description only)
    - SKILL.md under 500 lines with workflow that spawns kata-executor
    - 4 reference files exist with deviation rules, checkpoint protocol, TDD execution, commit protocol
  </done>
</task>

</tasks>

<verification>
1. Skill structure follows /building-claude-code-skills methodology
2. SKILL.md has proper frontmatter (name and description only)
3. SKILL.md under 500 lines with workflow referencing ./references/*.md
4. All 4 reference files contain extracted content from agent/workflow files
</verification>

<success_criteria>
- skills/kata-execution/SKILL.md exists with orchestrator workflow
- skills/kata-execution/references/ contains 4 reference files
- Skill can spawn kata-executor via Task tool
</success_criteria>

<output>
After completion, create `.planning/phases/00-convert-commands-to-skills/00-02-SUMMARY.md`
</output>
