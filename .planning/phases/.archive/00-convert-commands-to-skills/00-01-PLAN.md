---
phase: 00-convert-commands-to-skills
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/kata-planning-phases/SKILL.md
  - skills/kata-planning-phases/references/task-breakdown.md
  - skills/kata-planning-phases/references/dependency-graph.md
  - skills/kata-planning-phases/references/goal-backward.md
  - skills/kata-planning-phases/references/plan-format.md
  - bin/install.js
autonomous: true

must_haves:
  truths:
    - "User can invoke /kata-planning-phases skill from natural language"
    - "Skill spawns kata-planner and kata-plan-checker sub-agents via Task tool"
    - "Installation script copies skills/ directory to Claude config"
  artifacts:
    - path: "skills/kata-planning-phases/SKILL.md"
      provides: "Phase planning orchestrator skill"
      max_lines: 500
    - path: "skills/kata-planning-phases/references/task-breakdown.md"
      provides: "Task sizing and TDD detection guidance"
    - path: "bin/install.js"
      provides: "Updated installer with skills/ directory support"
      contains: "skills"
  key_links:
    - from: "skills/kata-planning-phases/SKILL.md"
      to: "agents/kata-planner.md"
      via: "Task tool spawn"
      pattern: "Task.*kata-planner"
    - from: "bin/install.js"
      to: "skills/"
      via: "copyWithPathReplacement"
      pattern: "skills"
---

<objective>
Create the kata-planning-phases skill and update the installer to support skills.

Purpose: This is the foundational skill that handles phase planning. Creating it first establishes the skill pattern and installer infrastructure that all subsequent skills depend on.

Output:
- skills/kata-planning-phases/ directory with SKILL.md and references/
- Updated bin/install.js to copy skills/ directory
</objective>

<execution_context>
@~/.claude/kata/workflows/execute-plan.md
@~/.claude/kata/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/00-convert-commands-to-skills/00-RESEARCH.md

# Skill-building methodology
@~/.claude/skills/building-claude-code-skills/SKILL.md
@~/.claude/skills/building-claude-code-skills/converting-slash-commands-to-skills.md

# Current implementation to extract workflow from
@commands/kata/phase-plan.md
@agents/kata-planner.md
@kata/workflows/phase-plan.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create kata-planning-phases skill with references</name>
  <files>
    skills/kata-planning-phases/SKILL.md
    skills/kata-planning-phases/references/task-breakdown.md
    skills/kata-planning-phases/references/dependency-graph.md
    skills/kata-planning-phases/references/goal-backward.md
    skills/kata-planning-phases/references/plan-format.md
  </files>
  <action>
Create the kata-planning-phases skill following /building-claude-code-skills methodology:

1. Create skills/kata-planning-phases/SKILL.md:
   - Frontmatter: name (kata-planning-phases), description (trigger-focused, 3rd person, includes "plan phase", "create execution plan", "task breakdown", "dependency analysis", "wave assignment")
   - NO allowed-tools, model, agent, context fields
   - Core workflow (~300 lines max):
     * Extract phase number from natural language context
     * Validate phase exists in ROADMAP.md
     * Check for existing research/context files
     * Spawn kata-phase-researcher if --research flag or no research exists
     * Spawn kata-planner to create PLAN.md files
     * Spawn kata-plan-checker to verify plans
     * Handle revision loop (max 3 iterations)
   - Reference supporting files with relative paths (./references/task-breakdown.md)

2. Create references/task-breakdown.md:
   - Task anatomy (files, action, verify, done)
   - Task types (auto, checkpoint:human-verify, checkpoint:decision, checkpoint:human-action)
   - Task sizing (15-60 min execution time)
   - TDD detection heuristic
   - Specificity examples

3. Create references/dependency-graph.md:
   - Building dependency graphs (needs/creates/has_checkpoint)
   - Wave assignment algorithm
   - Vertical slices vs horizontal layers
   - File ownership for parallel execution

4. Create references/goal-backward.md:
   - Goal-backward methodology
   - Observable truths derivation
   - Required artifacts derivation
   - Required wiring derivation
   - Key links identification
   - must_haves output format

5. Create references/plan-format.md:
   - PLAN.md structure (frontmatter, sections)
   - Frontmatter fields (phase, plan, type, wave, depends_on, etc.)
   - Context section rules
   - User setup frontmatter

Extract content from:
- agents/kata-planner.md (has detailed task breakdown, dependency graph, goal-backward content)
- kata/workflows/phase-plan.md (has workflow logic)
- commands/kata/phase-plan.md (has orchestration flow)
  </action>
  <verify>
    - ls skills/kata-planning-phases/ shows SKILL.md and references/ directory
    - wc -l skills/kata-planning-phases/SKILL.md shows less than 500 lines
    - grep "name: kata-planning-phases" skills/kata-planning-phases/SKILL.md returns match
    - grep "Task" skills/kata-planning-phases/SKILL.md shows sub-agent spawning
  </verify>
  <done>
    - SKILL.md exists with proper frontmatter (name, description only)
    - SKILL.md under 500 lines with workflow that spawns kata-planner, kata-plan-checker
    - 4 reference files exist with extracted content from agent/workflow files
  </done>
</task>

<task type="auto">
  <name>Task 2: Update installer to copy skills directory</name>
  <files>bin/install.js</files>
  <action>
Modify bin/install.js to copy the skills/ directory during installation:

1. After the agents copying block (around line 328), add a new block to copy skills:
   ```javascript
   // Copy skills to ~/.claude/skills (skill directories must be at root level)
   const skillsSrc = path.join(src, 'skills');
   if (fs.existsSync(skillsSrc)) {
     const skillsDest = path.join(claudeDir, 'skills');
     // Remove old Kata skills (kata-*) before copying new ones
     if (fs.existsSync(skillsDest)) {
       for (const dir of fs.readdirSync(skillsDest)) {
         if (dir.startsWith('kata-') && fs.statSync(path.join(skillsDest, dir)).isDirectory()) {
           fs.rmSync(path.join(skillsDest, dir), { recursive: true });
         }
       }
     }
     // Copy each skill directory with path replacement
     const skillEntries = fs.readdirSync(skillsSrc, { withFileTypes: true });
     for (const entry of skillEntries) {
       if (entry.isDirectory()) {
         const skillSrc = path.join(skillsSrc, entry.name);
         const skillDest = path.join(skillsDest, entry.name);
         copyWithPathReplacement(skillSrc, skillDest, pathPrefix);
       }
     }
     if (verifyInstalled(skillsDest, 'skills')) {
       console.log(`  ${green}âœ“${reset} Installed skills`);
     } else {
       failures.push('skills');
     }
   }
   ```

2. The copyWithPathReplacement function already handles:
   - Creating directories recursively
   - Replacing ~/.claude/ paths in .md files
   - Copying non-.md files as-is

This approach:
- Only removes kata-* skill directories (preserves user's custom skills)
- Uses existing copyWithPathReplacement for path handling
- Follows the same pattern as agents copying
  </action>
  <verify>
    - grep "skills" bin/install.js shows skills copying logic
    - grep "kata-" bin/install.js shows kata skill filtering
    - node bin/install.js --local (test local install)
    - ls .claude/skills/kata-planning-phases/ shows installed skill
  </verify>
  <done>
    - bin/install.js copies skills/ directory during installation
    - Only kata-* skills are removed on reinstall (user skills preserved)
    - Local install test shows skills/kata-planning-phases/ installed correctly
  </done>
</task>

</tasks>

<verification>
1. Skill structure follows /building-claude-code-skills methodology
2. SKILL.md has proper frontmatter (name and description only, no disallowed fields)
3. SKILL.md under 500 lines with workflow referencing ./references/*.md
4. Installer copies skills/ directory and verifies installation
5. Local install test passes and shows skills installed
</verification>

<success_criteria>
- skills/kata-planning-phases/SKILL.md exists with orchestrator workflow
- skills/kata-planning-phases/references/ contains 4 reference files
- bin/install.js updated to copy skills/ directory
- `node bin/install.js --local` installs skills successfully
</success_criteria>

<output>
After completion, create `.planning/phases/00-convert-commands-to-skills/00-01-SUMMARY.md`
</output>
