---
phase: 02.1-skill-resource-restructure
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - agents/references/checkpoints.md
  - agents/references/summary-template.md
  - agents/references/execute-plan.md
  - agents/kata-executor.md
  - agents/kata-planner.md
autonomous: true

must_haves:
  truths:
    - "Agents have their own references/ subdirectory"
    - "Agent files use relative @./references/ paths"
    - "No agents reference @~/.claude/kata/ paths"
  artifacts:
    - path: "agents/references/checkpoints.md"
      provides: "Checkpoint handling documentation for executor"
      min_lines: 20
    - path: "agents/references/summary-template.md"
      provides: "Summary template for plan completion"
      min_lines: 10
    - path: "agents/references/execute-plan.md"
      provides: "Execute plan workflow for planner"
      min_lines: 20
  key_links:
    - from: "agents/kata-executor.md"
      to: "agents/references/checkpoints.md"
      via: "@./references/checkpoints.md"
      pattern: "@\\./references/checkpoints\\.md"
    - from: "agents/kata-executor.md"
      to: "agents/references/summary-template.md"
      via: "@./references/summary-template.md"
      pattern: "@\\./references/summary-template\\.md"
---

<objective>
Create agents/references/ subdirectory and update agent files to use relative paths.

Purpose: Agents are subagent definitions spawned by skills. They also need to be self-contained with their own resources for consistent plugin/npx distribution.

Output: agents/ directory has its own references/ subdirectory and all agent files use relative paths.
</objective>

<context>
@.planning/phases/v1.0.6-02.1-skill-resource-restructure/02.1-RESEARCH.md

**Agent dependencies (from research):**

| Agent | References |
|-------|------------|
| kata-executor | checkpoints.md, summary.md template |
| kata-planner | execute-plan.md, summary.md |

Note: Unlike skills (which have SKILL.md as entry point), agents are standalone .md files in agents/. The references/ subdirectory sits alongside them.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create agents/references/ and copy required resources</name>
  <files>
    agents/references/checkpoints.md
    agents/references/summary-template.md
    agents/references/execute-plan.md
  </files>
  <action>
    Create agents/references/ subdirectory and copy resources:

    ```bash
    mkdir -p agents/references
    cp kata/references/checkpoints.md agents/references/
    cp kata/templates/summary.md agents/references/summary-template.md
    cp kata/workflows/execute-plan.md agents/references/
    ```

    Note: summary.md is renamed to summary-template.md to distinguish from other references.
  </action>
  <verify>
    ```bash
    ls agents/references/
    ```
    Should show: checkpoints.md, execute-plan.md, summary-template.md
  </verify>
  <done>agents/references/ directory created with checkpoints.md, execute-plan.md, and summary-template.md.</done>
</task>

<task type="auto">
  <name>Task 2: Update agent files to use relative paths</name>
  <files>
    agents/kata-executor.md
    agents/kata-planner.md
  </files>
  <action>
    Update @-references in agent files to use relative paths:

    **agents/kata-executor.md:**
    - Line 356: Change `@~/.claude/kata/references/checkpoints.md` to `@./references/checkpoints.md`
    - Line 613: Change `@~/.claude/kata/templates/summary.md` to `@./references/summary-template.md`

    **agents/kata-planner.md:**
    - Lines 410-411: Change:
      ```
      @~/.claude/kata/workflows/execute-plan.md
      @~/.claude/kata/templates/summary.md
      ```
      To:
      ```
      @./references/execute-plan.md
      @./references/summary-template.md
      ```

    Note: Paths use @./ which resolves relative to the file's directory (agents/).
  </action>
  <verify>
    ```bash
    grep -n "@~/.claude/kata/" agents/kata-executor.md
    grep -n "@~/.claude/kata/" agents/kata-planner.md
    ```
    Both commands should return empty (no matches).
  </verify>
  <done>Both agent files updated to use relative @./references/ paths.</done>
</task>

<task type="auto">
  <name>Task 3: Verify no kata/ references remain in agents</name>
  <files></files>
  <action>
    Run a comprehensive check across all agents to ensure no @~/.claude/kata/ references remain:

    ```bash
    grep -rn "@~/.claude/kata/" agents/
    ```

    If any matches found, update those files to use relative paths.
  </action>
  <verify>
    ```bash
    grep -rn "@~/.claude/kata/" agents/ | wc -l
    ```
    Should return 0.
  </verify>
  <done>No agents contain any @~/.claude/kata/ references.</done>
</task>

</tasks>

<verification>
- agents/references/ directory exists with required files
- All agent files use relative @./references/ paths
- grep -rn "@~/.claude/kata/" agents/ returns no matches
</verification>

<success_criteria>
- [ ] agents/references/ directory created
- [ ] checkpoints.md, execute-plan.md, summary-template.md copied
- [ ] kata-executor.md updated with relative paths
- [ ] kata-planner.md updated with relative paths
- [ ] No @~/.claude/kata/ references remain in agents/
</success_criteria>

<output>
After completion, create `.planning/phases/v1.0.6-02.1-skill-resource-restructure/02.1-03-SUMMARY.md`
</output>
