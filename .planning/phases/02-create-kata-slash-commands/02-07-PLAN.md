---
phase: 02-create-kata-slash-commands
plan: 07
type: execute
wave: 4
depends_on: ["02-06"]
files_modified:
  - bin/install.js
  - README.md
  - CLAUDE.md
autonomous: true

must_haves:
  truths:
    - "Installation includes commands/kata/ directory"
    - "README documents available /kata: commands"
    - "CLAUDE.md reflects command-based invocation alongside skills"
  artifacts:
    - path: "bin/install.js"
      provides: "Installer with commands support"
      contains: "commands/kata"
    - path: "README.md"
      provides: "Command reference documentation"
      contains: "/kata:"
    - path: "CLAUDE.md"
      provides: "Updated workflow documentation"
      contains: "/kata:"
  key_links:
    - from: "bin/install.js"
      to: "commands/kata/"
      via: "Copy during installation"
      pattern: "commands"
---

<objective>
Update installer to include commands, update README with command reference, update CLAUDE.md with command documentation.

Purpose: Complete the slash command integration by enabling installation and documentation
Output: Updated bin/install.js, README.md, CLAUDE.md
</objective>

<execution_context>
@~/.claude/kata/workflows/execute-plan.md
@~/.claude/kata/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-create-kata-slash-commands/02-CONTEXT.md

# Reference current files
@bin/install.js
@README.md
@CLAUDE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update installer to include commands</name>
  <files>bin/install.js</files>
  <action>
Update bin/install.js to:

1. **Remove orphaned directory entry** - Remove `'commands/kata'` from orphanedDirs array (line ~170) since we're re-adding commands

2. **Add commands copying** - Add section after skills copying to copy commands:

```javascript
// Copy commands to ~/.claude/commands (slash commands for explicit invocation)
const commandsSrc = path.join(src, 'commands');
if (fs.existsSync(commandsSrc)) {
  const commandsDest = path.join(claudeDir, 'commands');

  // Remove old kata commands before copying new ones
  const kataCommandsDest = path.join(commandsDest, 'kata');
  if (fs.existsSync(kataCommandsDest)) {
    fs.rmSync(kataCommandsDest, { recursive: true });
  }

  // Copy commands/kata directory with path replacement
  const kataCommandsSrc = path.join(commandsSrc, 'kata');
  if (fs.existsSync(kataCommandsSrc)) {
    copyWithPathReplacement(kataCommandsSrc, kataCommandsDest, pathPrefix);
  }

  if (verifyInstalled(kataCommandsDest, 'commands')) {
    console.log(`  ${green}âœ“${reset} Installed commands`);
  } else {
    failures.push('commands');
  }
}
```

3. **Update verification** - Add commands to the installation summary if desired
  </action>
  <verify>
```bash
# Check orphanedDirs doesn't include commands/kata
grep -A5 "orphanedDirs" bin/install.js

# Check commands copying section exists
grep -A10 "Copy commands" bin/install.js
```
  </verify>
  <done>Installer copies commands/kata/ directory during installation</done>
</task>

<task type="auto">
  <name>Task 2: Update README with command reference</name>
  <files>README.md</files>
  <action>
Add a "Slash Commands" section to README.md documenting all 25 commands.

**Section structure:**
```markdown
## Slash Commands

Kata provides explicit slash commands for deterministic invocation:

### Project & Milestones
| Command | Description |
|---------|-------------|
| `/kata:project-new` | Start a new Kata project |
| `/kata:project-status` | Show project progress |
| `/kata:milestone-new` | Create a new milestone |
| `/kata:milestone-complete` | Complete and archive milestone |
| `/kata:milestone-audit` | Audit milestone coverage |

### Roadmap
| Command | Description |
|---------|-------------|
| `/kata:phase-add` | Add phase to roadmap |
| `/kata:phase-insert` | Insert urgent phase |
| `/kata:phase-remove` | Remove future phase |
| `/kata:roadmap-plan-gaps` | Analyze coverage gaps |

### Research & Planning
| Command | Description |
|---------|-------------|
| `/kata:phase-discuss` | Gather implementation context |
| `/kata:phase-research` | Research phase domain |
| `/kata:phase-assumptions` | List phase assumptions |
| `/kata:phase-plan` | Create PLAN.md files |

### Execution & Verification
| Command | Description |
|---------|-------------|
| `/kata:phase-execute` | Execute phase plans |
| `/kata:work-verify` | Verify built work |
| `/kata:quick` | Quick task with atomic commit |

### Session & Utilities
| Command | Description |
|---------|-------------|
| `/kata:work-pause` | Pause and save state |
| `/kata:work-resume` | Resume from saved state |
| `/kata:codebase-map` | Map codebase structure |
| `/kata:todo-add` | Capture a todo |
| `/kata:todo-check` | Review pending todos |
| `/kata:workflow-debug` | Debug Kata issues |
| `/kata:help` | Show command reference |
| `/kata:update` | Check for updates |
| `/kata:whats-new` | Show changelog |
```

Place this section after the existing "Usage" section.
  </action>
  <verify>
```bash
# Check section exists
grep -A5 "## Slash Commands" README.md

# Check some commands documented
grep "/kata:phase-plan" README.md
grep "/kata:help" README.md
```
  </verify>
  <done>README includes complete command reference</done>
</task>

<task type="auto">
  <name>Task 3: Update CLAUDE.md with command documentation</name>
  <files>CLAUDE.md</files>
  <action>
Update CLAUDE.md to reflect the command-based invocation model:

1. **Update "Skills vs Commands" section** to clarify:
   - Skills: Autonomous invocation from natural language
   - Commands: Explicit invocation with `/kata:command-name`
   - Both delegate to the same underlying workflows

2. **Update workflow examples** to show both patterns:
   ```markdown
   **Common workflow when working on Kata:**
   1. Check progress: "What's the status?" or `/kata:project-status`
   2. Plan phase: "Plan phase [N]" or `/kata:phase-plan [N]`
   3. Execute: "Execute phase [N]" or `/kata:phase-execute [N]`
   4. Verify: "Verify phase [N]" or `/kata:work-verify [N]`
   ```

3. **Add note about user-invocable: false** explaining skills are not directly invocable via `/skill-name` but work through commands or natural language.

4. **Update Development Commands section** to include:
   ```markdown
   # Verify commands installed
   ls ~/.claude/commands/kata/  # global
   ls .claude/commands/kata/    # local
   ```
  </action>
  <verify>
```bash
# Check updates
grep "/kata:project-status" CLAUDE.md
grep "user-invocable" CLAUDE.md
grep "commands/kata" CLAUDE.md
```
  </verify>
  <done>CLAUDE.md reflects command-based invocation model</done>
</task>

</tasks>

<verification>
All infrastructure updates complete:

```bash
# Verify installer
node bin/install.js --local 2>&1 | grep -i command

# Verify README
grep -c "/kata:" README.md  # Should be 25+

# Verify CLAUDE.md
grep "/kata:" CLAUDE.md | head -5
```
</verification>

<success_criteria>
- [ ] bin/install.js copies commands/kata/ directory
- [ ] bin/install.js no longer marks commands/kata as orphaned
- [ ] README.md has "Slash Commands" section with all 25 commands
- [ ] CLAUDE.md updated with command invocation patterns
- [ ] CLAUDE.md documents user-invocable: false behavior
</success_criteria>

<output>
After completion, create `.planning/phases/02-create-kata-slash-commands/02-07-SUMMARY.md`
</output>
