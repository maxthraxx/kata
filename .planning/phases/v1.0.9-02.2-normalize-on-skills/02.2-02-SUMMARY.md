---
phase: 02.2-normalize-on-skills
plan: 02
subsystem: build
tags: [build, skills, plugin, namespace, distribution]

# Dependency graph
requires:
  - phase: 02.2-01
    provides: Skills are now user-invocable
provides:
  - Plugin skills namespaced cleanly: /kata:planning-phases (not /kata:kata-planning-phases)
  - NPX skills unchanged: /kata-planning-phases
  - transformSkillName() for name field transformation
  - renameSkillDir() for directory transformation
affects: [02.2-03]

# Tech tracking
tech-stack:
  added: []
  patterns: [dual-distribution-transforms]

key-files:
  created: []
  modified:
    - scripts/build.js

key-decisions:
  - "Strip kata- prefix from skill directories for plugin build"
  - "Strip kata- prefix from name field in SKILL.md for plugin build"
  - "NPX build unchanged to preserve standalone invocation"

patterns-established:
  - "dual-distribution-transforms: Plugin applies skill namespace transformation, NPX does not"

# Metrics
duration: 3min
completed: 2026-01-25
---

# Phase 02.2 Plan 02: Build.js Skill Prefix Transformation Summary

**Plugin build now strips kata- prefix from skill directories and names for clean /kata:skill-name invocation**

## Performance

- **Duration:** 3 min
- **Started:** 2026-01-25T04:47:00Z
- **Completed:** 2026-01-25T04:50:00Z
- **Tasks:** 4
- **Files modified:** 1

## Accomplishments

- Added `transformSkillName()` function to strip `kata-` from `name:` field in SKILL.md frontmatter
- Added `transformPluginContent()` combining agent reference and skill name transforms
- Added `renameSkillDir()` function to strip `kata-` from skill directory names
- Updated `copyDir()` and `copyPath()` to support optional directory renaming
- Plugin build now outputs: `dist/plugin/skills/planning-phases/` with `name: planning-phases`
- NPX build unchanged: `dist/npm/skills/kata-planning-phases/` with `name: kata-planning-phases`

## Task Commits

Each task was committed atomically:

1. **Task 1-3: Add skill transformation functions and directory renaming** - `fe0b1d3` (feat)
2. **Task 4: Commit build.js changes** - same commit

## Files Created/Modified

- `scripts/build.js` - Added skill name and directory transformation for plugin distribution

## Key Transformations

| Source | Plugin Output | NPX Output |
|--------|---------------|------------|
| `skills/kata-planning-phases/` | `skills/planning-phases/` | `skills/kata-planning-phases/` |
| `name: kata-planning-phases` | `name: planning-phases` | `name: kata-planning-phases` |
| Invocation | `/kata:planning-phases` | `/kata-planning-phases` |

## Decisions Made

- **Combined transform function:** Created `transformPluginContent()` that applies both agent reference and skill name transforms, keeping the logic organized
- **Directory rename via parameter:** Added `renameDir` parameter to `copyDir()` and `copyPath()` for flexible directory renaming without duplicating copy logic
- **Selective application:** Only apply directory renaming to the `skills` directory, not other COMMON_INCLUDES

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None

## User Setup Required

None - build changes apply automatically when running `node scripts/build.js plugin`.

## Next Phase Readiness

- Build system now handles skill namespace correctly for both distributions
- Ready for plan 03: Remove commands directory from distribution
- Plugin users will invoke skills via `/kata:planning-phases` (clean)
- NPX users will invoke skills via `/kata-planning-phases` (unchanged)

---
*Phase: 02.2-normalize-on-skills*
*Plan: 02*
*Completed: 2026-01-25*
