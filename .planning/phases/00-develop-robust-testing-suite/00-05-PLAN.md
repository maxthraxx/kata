---
phase: 00-develop-robust-testing-suite
plan: 05
type: execute
wave: 2
depends_on: ["00-01"]
files_modified:
  - tests/skills/planning-phases.test.js
  - tests/skills/executing-phases.test.js
  - tests/skills/verifying-work.test.js
  - tests/skills/researching-phases.test.js
  - tests/skills/executing-quick-tasks.test.js
  - tests/skills/planning-milestone-gaps.test.js
autonomous: true

must_haves:
  truths:
    - "planning-phases skill creates PLAN.md files"
    - "executing-phases skill runs plan tasks"
    - "verifying-work skill checks completion criteria"
    - "researching-phases skill creates RESEARCH.md"
    - "executing-quick-tasks skill handles ad-hoc tasks"
    - "planning-milestone-gaps skill identifies missing work"
  artifacts:
    - path: "tests/skills/planning-phases.test.js"
      provides: "Test for kata-planning-phases skill"
      min_lines: 50
    - path: "tests/skills/executing-phases.test.js"
      provides: "Test for kata-executing-phases skill"
      min_lines: 50
    - path: "tests/skills/verifying-work.test.js"
      provides: "Test for kata-verifying-work skill"
      min_lines: 40
    - path: "tests/skills/researching-phases.test.js"
      provides: "Test for kata-researching-phases skill"
      min_lines: 40
    - path: "tests/skills/executing-quick-tasks.test.js"
      provides: "Test for kata-executing-quick-tasks skill"
      min_lines: 40
    - path: "tests/skills/planning-milestone-gaps.test.js"
      provides: "Test for kata-planning-milestone-gaps skill"
      min_lines: 30
  key_links:
    - from: "tests/skills/planning-phases.test.js"
      to: ".planning/phases/"
      via: "assertFileMatchesPattern"
      pattern: "PLAN\\.md"
---

<objective>
Create skill tests for execution workflow skills (Wave 4 of skill testing).

Purpose: Test the core workflow skills - planning, executing, verifying, and researching phases. These are Kata's most complex skills and require richer fixture state.

Output: 6 skill test files covering the complete Kata execution workflow.
</objective>

<context>
@.planning/PROJECT.md
@.planning/phases/00-develop-robust-testing-suite/00-CONTEXT.md
@.planning/phases/00-develop-robust-testing-suite/00-RESEARCH.md

Test harness:
@tests/harness/claude-cli.js
@tests/harness/assertions.js
@tests/harness/runner.js

Skills to test:
@skills/kata-planning-phases/SKILL.md
@skills/kata-executing-phases/SKILL.md
@skills/kata-verifying-work/SKILL.md
@skills/kata-researching-phases/SKILL.md
@skills/kata-executing-quick-tasks/SKILL.md
@skills/kata-planning-milestone-gaps/SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create planning-phases.test.js and executing-phases.test.js</name>
  <files>tests/skills/planning-phases.test.js, tests/skills/executing-phases.test.js</files>
  <action>
Create `tests/skills/planning-phases.test.js`:
1. Standard setup/teardown with kata-planning-phases skill
2. In beforeEach:
   - Add Phase 1 to ROADMAP.md with goal and success criteria
   - Create .planning/phases/01-test-phase/ directory
   - Create 01-CONTEXT.md with implementation decisions (required for planning)
3. Test cases:
   - "responds to 'plan phase 1'" - assert skill invoked
   - "creates PLAN.md files" - use assertFileMatchesPattern for *-PLAN.md in phase directory
   - "updates ROADMAP.md with plan count" - assert ROADMAP.md mentions "plans"

Create `tests/skills/executing-phases.test.js`:
1. Standard setup/teardown with kata-executing-phases skill
2. In beforeEach:
   - Set up Phase 1 in ROADMAP.md
   - Create .planning/phases/01-test-phase/01-01-PLAN.md with a simple task (e.g., create a file)
3. Test cases:
   - "responds to 'execute phase 1'" - assert skill invoked
   - "creates SUMMARY.md after execution" - assert *-SUMMARY.md exists or execution output

Use config.budgets.expensive ($5.00) and config.timeouts.expensive (300s) - these are complex workflows.
  </action>
  <verify>
```bash
node --test tests/skills/planning-phases.test.js tests/skills/executing-phases.test.js
```
  </verify>
  <done>planning-phases.test.js verifies PLAN.md creation, executing-phases.test.js verifies plan execution</done>
</task>

<task type="auto">
  <name>Task 2: Create verifying-work.test.js and researching-phases.test.js</name>
  <files>tests/skills/verifying-work.test.js, tests/skills/researching-phases.test.js</files>
  <action>
Create `tests/skills/verifying-work.test.js`:
1. Standard setup/teardown with kata-verifying-work skill
2. In beforeEach:
   - Set up Phase 1 with ROADMAP.md entry including success criteria
   - Create phase directory with completed SUMMARY.md files
3. Test cases:
   - "responds to 'verify phase 1'" - assert skill invoked
   - "checks success criteria" - assert result mentions verification or criteria checking
   - "creates verification output" - assert VERIFICATION.md created or verification reported

Create `tests/skills/researching-phases.test.js`:
1. Standard setup/teardown with kata-researching-phases skill
2. In beforeEach:
   - Set up Phase 1 in ROADMAP.md with research-worthy goal
   - Create .planning/phases/01-test-phase/ directory
3. Test cases:
   - "responds to 'research phase 1'" - assert skill invoked
   - "creates RESEARCH.md" - assert 01-RESEARCH.md exists in phase directory

Use config.budgets.expensive ($5.00) for verifying-work, config.budgets.standard ($2.00) for researching.
  </action>
  <verify>
```bash
node --test tests/skills/verifying-work.test.js tests/skills/researching-phases.test.js
```
  </verify>
  <done>verifying-work.test.js verifies success criteria checking, researching-phases.test.js verifies RESEARCH.md creation</done>
</task>

<task type="auto">
  <name>Task 3: Create executing-quick-tasks.test.js and planning-milestone-gaps.test.js</name>
  <files>tests/skills/executing-quick-tasks.test.js, tests/skills/planning-milestone-gaps.test.js</files>
  <action>
Create `tests/skills/executing-quick-tasks.test.js`:
1. Standard setup/teardown with kata-executing-quick-tasks skill
2. Test cases:
   - "responds to 'quick task: add a README'" - assert skill invoked
   - "creates quick task artifacts" - assert .planning/quick/ directory created or quick task output

Create `tests/skills/planning-milestone-gaps.test.js`:
1. Standard setup/teardown with kata-planning-milestone-gaps skill
2. In beforeEach:
   - Set up milestone in ROADMAP.md with incomplete phases
   - Add phases with incomplete plans
3. Test cases:
   - "responds to 'check milestone gaps'" - assert skill invoked
   - "identifies missing work" - assert result mentions gaps, missing, or incomplete

Use config.budgets.standard ($2.00) for executing-quick-tasks, config.budgets.quick ($0.50) for planning-milestone-gaps.
  </action>
  <verify>
```bash
node --test tests/skills/executing-quick-tasks.test.js tests/skills/planning-milestone-gaps.test.js
```
  </verify>
  <done>executing-quick-tasks.test.js verifies ad-hoc task execution, planning-milestone-gaps.test.js verifies gap detection</done>
</task>

</tasks>

<verification>
```bash
# Run all Wave 4 execution workflow skill tests
node --test tests/skills/planning-phases.test.js tests/skills/executing-phases.test.js tests/skills/verifying-work.test.js tests/skills/researching-phases.test.js tests/skills/executing-quick-tasks.test.js tests/skills/planning-milestone-gaps.test.js
```
All tests pass (requires ANTHROPIC_API_KEY). Note: These tests take longer due to workflow complexity.
</verification>

<success_criteria>
- 6 test files created for execution workflow skills
- planning-phases verifies PLAN.md creation
- executing-phases verifies plan execution and SUMMARY.md
- verifying-work verifies criteria checking
- researching-phases verifies RESEARCH.md creation
- Tests use appropriate expensive budget/timeout for complex skills
</success_criteria>

<output>
After completion, create `.planning/phases/00-develop-robust-testing-suite/00-05-SUMMARY.md`
</output>
