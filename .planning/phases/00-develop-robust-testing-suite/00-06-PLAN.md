---
phase: 00-develop-robust-testing-suite
plan: 06
type: execute
wave: 2
depends_on: ["00-01"]
files_modified:
  - tests/skills/debugging.test.js
  - tests/skills/mapping-codebases.test.js
  - tests/skills/starting-projects.test.js
  - tests/skills/updating.test.js
autonomous: true

must_haves:
  truths:
    - "debugging skill helps diagnose issues"
    - "mapping-codebases skill analyzes codebase structure"
    - "starting-projects skill initializes Kata project"
    - "updating skill handles Kata updates"
  artifacts:
    - path: "tests/skills/debugging.test.js"
      provides: "Test for kata-debugging skill"
      min_lines: 30
    - path: "tests/skills/mapping-codebases.test.js"
      provides: "Test for kata-mapping-codebases skill"
      min_lines: 40
    - path: "tests/skills/starting-projects.test.js"
      provides: "Test for kata-starting-projects skill"
      min_lines: 50
    - path: "tests/skills/updating.test.js"
      provides: "Test for kata-updating skill"
      min_lines: 30
  key_links:
    - from: "tests/skills/starting-projects.test.js"
      to: ".planning/"
      via: "assertArtifactExists"
      pattern: "assertArtifactExists.*\\.planning"
---

<objective>
Create skill tests for utility skills (Wave 5 of skill testing).

Purpose: Test remaining utility skills including debugging, codebase analysis, project initialization, and updates. These complete the full skill test coverage.

Output: 4 skill test files covering utility and initialization skills.
</objective>

<context>
@.planning/PROJECT.md
@.planning/phases/00-develop-robust-testing-suite/00-CONTEXT.md
@.planning/phases/00-develop-robust-testing-suite/00-RESEARCH.md

Test harness:
@tests/harness/claude-cli.js
@tests/harness/assertions.js

Skills to test:
@skills/kata-debugging/SKILL.md
@skills/kata-mapping-codebases/SKILL.md
@skills/kata-starting-projects/SKILL.md
@skills/kata-updating/SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create debugging.test.js and mapping-codebases.test.js</name>
  <files>tests/skills/debugging.test.js, tests/skills/mapping-codebases.test.js</files>
  <action>
Create `tests/skills/debugging.test.js`:
1. Standard setup/teardown with kata-debugging skill
2. In beforeEach, create a scenario with an error state (e.g., missing file, broken reference)
3. Test cases:
   - "responds to 'debug this issue'" - assert skill invoked
   - "analyzes problem" - assert result mentions diagnosis, error, or investigation

Create `tests/skills/mapping-codebases.test.js`:
1. Standard setup/teardown with kata-mapping-codebases skill
2. In beforeEach:
   - Create a simple codebase structure (src/index.js, src/utils.js, etc.)
3. Test cases:
   - "responds to 'map this codebase'" - assert skill invoked
   - "creates codebase analysis" - assert .planning/codebase/ directory created or analysis output
   - "identifies file structure" - assert result mentions files or structure

Use config.budgets.standard ($2.00) for debugging, config.budgets.expensive ($5.00) for mapping (scans many files).
  </action>
  <verify>
```bash
node --test tests/skills/debugging.test.js tests/skills/mapping-codebases.test.js
```
  </verify>
  <done>debugging.test.js verifies issue diagnosis, mapping-codebases.test.js verifies codebase analysis</done>
</task>

<task type="auto">
  <name>Task 2: Create starting-projects.test.js</name>
  <files>tests/skills/starting-projects.test.js</files>
  <action>
Create `tests/skills/starting-projects.test.js`:
1. Use a FRESH temp directory (not the kata-project fixture) since starting-projects initializes from scratch
2. Install kata-starting-projects skill
3. Test cases:
   - "responds to 'start a new kata project'" - assert skill invoked
   - "creates .planning directory" - assertArtifactExists for .planning/
   - "creates PROJECT.md" - assertArtifactExists for .planning/PROJECT.md
   - "creates ROADMAP.md" - assertArtifactExists for .planning/ROADMAP.md
   - "creates STATE.md" - assertArtifactExists for .planning/STATE.md

Use config.budgets.standard ($2.00) and config.timeouts.standard (180s).
Note: This test is unique because it starts from empty directory, not the fixture.
  </action>
  <verify>
```bash
node --test tests/skills/starting-projects.test.js
```
  </verify>
  <done>starting-projects.test.js verifies full project initialization from empty directory</done>
</task>

<task type="auto">
  <name>Task 3: Create updating.test.js</name>
  <files>tests/skills/updating.test.js</files>
  <action>
Create `tests/skills/updating.test.js`:
1. Standard setup/teardown with kata-updating skill
2. Test cases:
   - "responds to 'update kata'" - assert skill invoked
   - "reports version information" - assert result mentions version, update, or current

Use config.budgets.quick ($0.50) - update check is typically fast.

Note: This test may need special handling since actual updates require npm/network. Test should verify the skill triggers and reports status, not necessarily perform actual update.
  </action>
  <verify>
```bash
node --test tests/skills/updating.test.js
```
  </verify>
  <done>updating.test.js verifies update check workflow</done>
</task>

</tasks>

<verification>
```bash
# Run all Wave 5 utility skill tests
node --test tests/skills/debugging.test.js tests/skills/mapping-codebases.test.js tests/skills/starting-projects.test.js tests/skills/updating.test.js
```
All tests pass (requires ANTHROPIC_API_KEY).
</verification>

<success_criteria>
- 4 test files created for utility skills
- debugging tests verify issue diagnosis
- mapping-codebases tests verify structure analysis
- starting-projects tests verify full initialization (uses empty directory)
- updating tests verify update workflow
- All 27 skills now have test coverage
</success_criteria>

<output>
After completion, create `.planning/phases/00-develop-robust-testing-suite/00-06-SUMMARY.md`
</output>
