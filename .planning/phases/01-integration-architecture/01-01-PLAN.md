---
phase: 01-integration-architecture
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/integrations/INTEGRATIONS.md
  - .planning/integrations/github/config.json
  - .claude/hooks/hooks.json
  - .claude/hooks/scripts/on-gsd-event.sh
autonomous: true

must_haves:
  truths:
    - "Integration registry exists and documents available integrations"
    - "GSD workflow events can be detected by hook scripts"
    - "Hook infrastructure follows Claude Code native patterns"
  artifacts:
    - path: ".planning/integrations/INTEGRATIONS.md"
      provides: "Integration registry with event documentation"
      contains: "## Active Integrations"
    - path: ".planning/integrations/github/config.json"
      provides: "GitHub integration configuration placeholder"
      min_lines: 5
    - path: ".claude/hooks/hooks.json"
      provides: "Claude Code hook configuration"
      contains: "PostToolUse"
    - path: ".claude/hooks/scripts/on-gsd-event.sh"
      provides: "GSD event detection script"
      min_lines: 30
  key_links:
    - from: ".claude/hooks/hooks.json"
      to: ".claude/hooks/scripts/on-gsd-event.sh"
      via: "command field referencing script"
      pattern: "on-gsd-event\\.sh"
---

<objective>
Create the foundation for GSD's extensible integration architecture: an integration registry and hook infrastructure for detecting GSD workflow events.

Purpose: Enable integrations (GitHub, Linear, Jira) to hook into GSD workflow events without modifying core GSD code. This is the extension mechanism that all integrations will use.

Output: Integration registry at `.planning/integrations/`, Claude Code hooks configuration at `.claude/hooks/`, and event detection script that identifies GSD workflow completions.
</objective>

<execution_context>
@~/.claude/kata/workflows/execute-plan.md
@~/.claude/kata/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-integration-architecture/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create integration registry structure</name>
  <files>
    .planning/integrations/INTEGRATIONS.md
    .planning/integrations/github/config.json
  </files>
  <action>
Create the integration registry structure:

1. Create `.planning/integrations/INTEGRATIONS.md` with:
   - Active Integrations table (Integration | Status | Skill | Config columns)
   - Event Subscriptions section documenting available GSD events
   - Available Events table with: phase:start, phase:complete, plan:start, plan:complete, task:complete
   - Each event documents: when it triggers, what data it provides
   - GitHub Integration Events section showing GSD event -> GitHub action mappings

2. Create `.planning/integrations/github/config.json` with:
   - enabled: true
   - repo: null (to be configured per-project)
   - issue_sync: { enabled: false, label_prefix: "gsd:" }
   - pr_creation: { enabled: false, draft: true }

The registry is the single source of truth for which integrations are active and how events map to actions.
  </action>
  <verify>
    - `cat .planning/integrations/INTEGRATIONS.md` shows Active Integrations table and Event Subscriptions
    - `cat .planning/integrations/github/config.json` parses as valid JSON
    - `jq . .planning/integrations/github/config.json` succeeds
  </verify>
  <done>
    - Integration registry exists at .planning/integrations/INTEGRATIONS.md
    - GitHub config placeholder exists at .planning/integrations/github/config.json
    - Events documented: phase:start, phase:complete, plan:start, plan:complete, task:complete
  </done>
</task>

<task type="auto">
  <name>Task 2: Create hook infrastructure for GSD events</name>
  <files>
    .claude/hooks/hooks.json
    .claude/hooks/scripts/on-gsd-event.sh
  </files>
  <action>
Create Claude Code hook configuration and GSD event detection script:

1. Create `.claude/hooks/hooks.json` (Claude Code hooks configuration):
```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Task",
        "hooks": [
          {
            "type": "command",
            "command": ".claude/hooks/scripts/on-gsd-event.sh"
          }
        ]
      }
    ]
  }
}
```

2. Create `.claude/hooks/scripts/on-gsd-event.sh` (executable shell script):
   - Read hook input from stdin (JSON with tool_name, cwd, transcript_path)
   - Only process Task tool completions (GSD subagent returns)
   - Check for recently created GSD artifacts:
     - *-SUMMARY.md in .planning/phases/ -> plan:complete event
     - *-VERIFICATION.md with status: passed -> phase:complete event
   - When event detected:
     - Extract phase/plan info from file path
     - Write event to `.planning/integrations/events.jsonl` (append)
     - Event format: {"event": "plan:complete", "plan_id": "01-02", "path": "...", "timestamp": ...}
   - Exit 0 always (hooks should not block workflow)

Key design decisions:
- Detect events by artifact existence (not parsing Claude output - brittle)
- Use find with -mmin -1 to detect recently created files
- Append to events.jsonl for integration consumption (they poll this file)
- Keep script fast (< 5 seconds) to avoid blocking Claude

Make script executable: chmod +x .claude/hooks/scripts/on-gsd-event.sh
  </action>
  <verify>
    - `jq . .claude/hooks/hooks.json` parses successfully
    - `test -x .claude/hooks/scripts/on-gsd-event.sh` confirms executable
    - `bash -n .claude/hooks/scripts/on-gsd-event.sh` confirms valid bash syntax
    - Script has shebang: `head -1 .claude/hooks/scripts/on-gsd-event.sh` shows #!/usr/bin/env bash
  </verify>
  <done>
    - hooks.json configures PostToolUse hook for Task tool
    - on-gsd-event.sh detects SUMMARY.md and VERIFICATION.md creation
    - Events written to .planning/integrations/events.jsonl
    - Script is executable and has valid bash syntax
  </done>
</task>

</tasks>

<verification>
Integration foundation verified when:
1. Registry structure exists and documents the event system
2. Hook configuration points to event detection script
3. Event detection script has valid syntax and is executable
4. The pattern follows Claude Code native hook conventions
</verification>

<success_criteria>
- Integration registry at .planning/integrations/INTEGRATIONS.md documents 5 GSD events
- GitHub config placeholder exists with proper JSON structure
- hooks.json configures PostToolUse hook for Task tool completions
- on-gsd-event.sh is executable and detects GSD artifact creation
- No modifications to core Kata files (commands/, agents/, kata/)
</success_criteria>

<output>
After completion, create `.planning/phases/01-integration-architecture/01-01-SUMMARY.md`
</output>
