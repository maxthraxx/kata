---
phase: 01-migrate-todo-commands
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - skills/kata-todo-management/SKILL.md
  - skills/kata-todo-management/references/actions.md
autonomous: true

must_haves:
  truths:
    - "User can say 'check todos' and see list of pending todos"
    - "User can choose action for each todo (work on, add to phase, create phase, brainstorm, put back, mark complete)"
    - "Work on now displays todo content and exits skill"
    - "Add to phase adds todo to ROADMAP backlog and moves to done/"
    - "Create phase invokes kata-managing-project-roadmap"
    - "Brainstorm continues conversation about todo"
    - "Put back keeps todo in pending, shows next"
    - "Mark complete moves todo to done/ for external completion"
  artifacts:
    - path: "skills/kata-todo-management/SKILL.md"
      provides: "Complete skill with ADD and CHECK operations"
      max_lines: 500
    - path: "skills/kata-todo-management/references/actions.md"
      provides: "Detailed action workflows for CHECK operation"
  key_links:
    - from: "SKILL.md"
      to: "references/actions.md"
      via: "See reference for action details"
      pattern: "See.*actions.md"
    - from: "SKILL.md"
      to: "kata-managing-project-roadmap"
      via: "Invoke for create phase action"
      pattern: "kata-managing-project-roadmap"
    - from: "SKILL.md"
      to: ".planning/todos/done/"
      via: "Move completed todos"
      pattern: "\\.planning/todos/done/"
---

<objective>
Add CHECK operation to kata-todo-management skill with action options for reviewing and acting on pending todos.

Purpose: Complete the skill by adding the review workflow that lets users triage pending todos with actionable choices.

Output: Updated SKILL.md with CHECK operation and new references/actions.md with detailed action workflows.
</objective>

<execution_context>
@~/.claude/kata/workflows/execute-plan.md
@~/.claude/kata/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-migrate-todo-commands/01-RESEARCH.md

# Skill being updated (from Plan 01-01)
@skills/kata-todo-management/SKILL.md
@skills/kata-todo-management/references/todo-format.md

# Pattern for AskUserQuestion actions
@skills/kata-manageing-milestones/SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add CHECK operation workflow to SKILL.md</name>
  <files>skills/kata-todo-management/SKILL.md</files>
  <action>
Update SKILL.md to add the CHECK operation workflow, replacing the placeholder from Plan 01-01:

1. **CHECK Operation Workflow section:**
   - Step 1: List pending todos
     ```bash
     ls .planning/todos/pending/*.md 2>/dev/null | wc -l
     ```
     - If 0: "No pending todos. Use 'add todo' to capture ideas."
     - If >0: Display count and proceed

   - Step 2: For each todo in pending/:
     a. Read todo file, extract title and area
     b. Display summary:
        ```
        ### [Title]
        **Area:** [area] | **Type:** [type] | **Created:** [date]
        ```
     c. Use AskUserQuestion with options:
        ```
        question="What would you like to do with '[Title]'?"
        options=[
          "work on now",
          "add to current phase",
          "create new phase",
          "brainstorm ideas",
          "put back (review later)",
          "mark complete"
        ]
        ```

   - Step 3: Route based on selection:
     - "work on now" → See actions.md, display content, exit skill
     - "add to phase" → See actions.md, update ROADMAP, move to done/
     - "create phase" → See actions.md, invoke kata-managing-project-roadmap
     - "brainstorm" → See actions.md, continue conversation
     - "put back" → Skip, show next todo (or exit if last)
     - "mark complete" → Move to done/, show next todo

   - Step 4: After all todos reviewed or user exits:
     - Update STATE.md pending count
     - Show summary: "Reviewed [N] todos: [X] completed, [Y] actioned, [Z] pending"

2. **Keep total SKILL.md under 500 lines** by:
   - Linking to actions.md for detailed action workflows
   - Keeping CHECK flow to routing logic only
   - Using "See ./references/actions.md for detailed action workflows"

3. **Next Action format** at end of CHECK:
   ```
   ───────────────────────────────────────────────────────────

   ## ▶ Next Action

   **Todo review complete**

   | Action           | Natural Trigger | Explicit Command       |
   | ---------------- | --------------- | ---------------------- |
   | **Add more**     | "add todo"      | `/kata-todo-management` |
   | Work on todos    | "check todos"   | `/kata-todo-management` |

   <sub>`/clear` first → fresh context window</sub>

   ───────────────────────────────────────────────────────────
   ```
  </action>
  <verify>grep -c "CHECK Operation" skills/kata-todo-management/SKILL.md shows 1; wc -l skills/kata-todo-management/SKILL.md shows < 500</verify>
  <done>SKILL.md has complete CHECK operation with AskUserQuestion routing, under 500 lines</done>
</task>

<task type="auto">
  <name>Task 2: Create references/actions.md with detailed action workflows</name>
  <files>skills/kata-todo-management/references/actions.md</files>
  <action>
Create reference file documenting each CHECK action in detail:

1. **Overview:**
   - Purpose: Detailed workflows for each check-todos action
   - Actions are lightweight routing, not full sub-agent workflows

2. **Action 1: Work On Now**
   **Behavior:** Display todo content, exit skill, user takes over
   **Steps:**
   1. Read full todo file content
   2. Display formatted output:
      ```
      ## Working on: [Title]

      [Todo body content]

      ---
      **Area:** [area] | **Type:** [type]
      **Files involved:**
      - [file1]
      - [file2]

      When done, say "mark [title] complete" or "check todos" to continue.
      ```
   3. Exit skill (user continues naturally)
   **Note:** Does NOT move to done/ - user explicitly marks complete later

3. **Action 2: Add to Current Phase**
   **Behavior:** Parse todo into task, add to ROADMAP backlog, move to done/
   **Prerequisites:** Current phase must exist in ROADMAP.md
   **Steps:**
   1. Read ROADMAP.md, find current phase section
   2. Add todo title to phase "Backlog" or "Tasks" list
   3. Move todo file: mv pending/{file} done/{file}
   4. Update STATE.md pending count
   5. Display confirmation:
      ```
      Added "[Title]" to Phase [X] backlog.
      Todo moved to done/.

      Next: /kata-planning to incorporate into plans
      ```

4. **Action 3: Create New Phase**
   **Behavior:** Route to kata-managing-project-roadmap add-phase operation
   **Steps:**
   1. Extract phase name from todo title (suggest to user)
   2. Extract goal from todo body
   3. Display:
      ```
      Creating phase from todo...

      Suggested:
      - **Name:** [derived from title]
      - **Goal:** [from body]

      Invoking kata-managing-project-roadmap to add phase...
      ```
   4. Invoke: `/kata-managing-project-roadmap add-phase`
   5. After phase created, move todo to done/
   6. Update STATE.md

5. **Action 4: Brainstorm**
   **Behavior:** Continue conversation about the todo
   **Steps:**
   1. Display todo content
   2. Add conversational prompt:
      ```
      Let's discuss: [Title]

      [Todo body]

      What aspects would you like to explore?
      - Technical approach?
      - Scope clarification?
      - Dependencies?
      - Alternative solutions?
      ```
   3. Skill completes, normal conversation continues
   **Note:** Todo stays in pending/ until explicitly actioned

6. **Action 5: Put Back**
   **Behavior:** Skip this todo, show next (or exit if last)
   **Steps:**
   1. Do nothing to the todo file
   2. If more todos: Show next todo with AskUserQuestion
   3. If last todo: Exit with summary
   **Note:** Simple skip, no file changes

7. **Action 6: Mark Complete**
   **Behavior:** Move to done/ for todos worked on outside Kata
   **Steps:**
   1. Move file: mv pending/{file} done/{file}
   2. Update STATE.md pending count
   3. Display: "[Title]" marked complete.
   4. Show next todo or exit summary

8. **STATE.md Update Pattern:**
   After any action that changes pending count:
   ```bash
   # Count pending todos
   count=$(ls .planning/todos/pending/*.md 2>/dev/null | wc -l | tr -d ' ')

   # Update STATE.md "Pending Todos" section
   # Replace "N pending todos:" with new count
   # Update todo list if displayed
   ```
  </action>
  <verify>cat skills/kata-todo-management/references/actions.md | grep -c "Action [1-6]" shows 6</verify>
  <done>actions.md exists with all 6 action workflows documented including STATE.md update pattern</done>
</task>

</tasks>

<verification>
After both tasks:
- [ ] SKILL.md has CHECK operation workflow
- [ ] SKILL.md uses AskUserQuestion with 6 options
- [ ] SKILL.md routes to actions.md for details
- [ ] SKILL.md still under 500 lines total
- [ ] references/actions.md has all 6 actions documented
- [ ] Each action has clear steps and expected output
- [ ] STATE.md update pattern documented
</verification>

<success_criteria>
- CHECK operation lists pending todos with count
- Each todo presented with AskUserQuestion having 6 action options
- Actions route to detailed workflows in actions.md
- "Work on now" displays content and exits (does not complete)
- "Mark complete" moves to done/ (for external completion)
- STATE.md updated after actions that change pending count
- SKILL.md total remains under 500 lines
</success_criteria>

<output>
After completion, create `.planning/phases/01-migrate-todo-commands/01-02-SUMMARY.md`
</output>
