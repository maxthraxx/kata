---
phase: 00-convert-commands-to-skills
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/kata-planning/SKILL.md
  - skills/kata-planning/references/task-breakdown.md
  - skills/kata-planning/references/dependency-graph.md
  - skills/kata-planning/references/goal-backward.md
  - skills/kata-planning/references/plan-format.md
  - skills/kata-planning/references/gap-closure.md
  - commands/kata/plan-phase.md
  - commands/kata/list-phase-assumptions.md
  - agents/kata-planner.md
  - agents/kata-plan-checker.md
  - bin/install.js
autonomous: true

must_haves:
  truths:
    - "/kata:plan-phase creates PLAN.md files with task breakdown"
    - "Claude autonomously invokes kata-planning when user asks to plan a phase"
    - "kata-planner agent has access to planning skill knowledge"
  artifacts:
    - path: "skills/kata-planning/SKILL.md"
      provides: "Core planning workflow with trigger-focused description"
      min_lines: 150
    - path: "skills/kata-planning/references/task-breakdown.md"
      provides: "Task sizing, specificity, TDD detection"
      min_lines: 50
    - path: "commands/kata/plan-phase.md"
      provides: "Thin wrapper with skills: kata-planning in frontmatter"
      contains: "skills:"
  key_links:
    - from: "commands/kata/plan-phase.md"
      to: "skills/kata-planning/SKILL.md"
      via: "skills: frontmatter field"
      pattern: "skills:.*kata-planning"
    - from: "agents/kata-planner.md"
      to: "skills/kata-planning"
      via: "skills: frontmatter field"
      pattern: "skills:.*kata-planning"
---

<objective>
Create the kata-planning skill from existing plan-phase command, workflows, and kata-planner agent content.

Purpose: Enable autonomous skill invocation for phase planning while preserving deterministic /kata:plan-phase execution.

Output: skills/kata-planning/ directory with SKILL.md and references/, updated command and agent frontmatter.

**CRITICAL: Skills use FLAT directory naming. Use `skills/kata-planning/` NOT `skills/kata/kata-planning/`**
</objective>

<execution_context>
@~/.claude/kata/workflows/execute-plan.md
@~/.claude/kata/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/00-convert-commands-to-skills/00-RESEARCH.md

Source files to extract from:
@commands/kata/plan-phase.md
@agents/kata-planner.md
@kata/workflows/execute-plan.md (planning sections)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create kata-planning skill structure</name>
  <files>
    skills/kata-planning/SKILL.md,
    skills/kata-planning/references/task-breakdown.md,
    skills/kata-planning/references/dependency-graph.md,
    skills/kata-planning/references/goal-backward.md,
    skills/kata-planning/references/plan-format.md,
    skills/kata-planning/references/gap-closure.md
  </files>
  <action>
    Create skills/kata-planning/ directory structure (FLAT naming, no nested kata/ folder).

    **SKILL.md (~200 lines):**
    - Frontmatter: name: kata-planning, description with trigger phrases ("plan a phase", "break down tasks", "create execution plan", "analyze dependencies", "goal-backward verification")
    - Extract core workflow from agents/kata-planner.md: philosophy, task breakdown overview, dependency graph overview, must_haves overview, execution flow summary
    - Reference the detailed files in references/ for deep dives
    - Keep under 500 lines

    **references/task-breakdown.md:**
    - Extract from kata-planner.md: task anatomy (files, action, verify, done), task types, task sizing, specificity examples, TDD detection heuristic

    **references/dependency-graph.md:**
    - Extract from kata-planner.md: building dependency graph, wave assignment, vertical slices vs horizontal layers, file ownership

    **references/goal-backward.md:**
    - Extract from kata-planner.md: goal-backward methodology, observable truths, required artifacts, required wiring, key links, must_haves format

    **references/plan-format.md:**
    - Extract from kata-planner.md: PLAN.md structure, frontmatter fields, context section rules, user setup frontmatter

    **references/gap-closure.md:**
    - Extract from kata-planner.md: gap closure mode, revision mode

    Do NOT duplicate content - move it from agent to skill.
  </action>
  <verify>
    ls skills/kata-planning/ shows SKILL.md and references/ directory.
    wc -l skills/kata-planning/SKILL.md is between 150-500 lines.
    grep "name: kata-planning" skills/kata-planning/SKILL.md succeeds.
  </verify>
  <done>Skill directory exists with SKILL.md (trigger-focused description) and 5 reference files containing planning domain knowledge.</done>
</task>

<task type="auto">
  <name>Task 2: Update commands and agents to reference skill</name>
  <files>
    commands/kata/plan-phase.md,
    commands/kata/list-phase-assumptions.md,
    agents/kata-planner.md,
    agents/kata-plan-checker.md
  </files>
  <action>
    **commands/kata/plan-phase.md:**
    - Add `skills: kata-planning` to frontmatter (after agent: line)
    - Add `context: fork` to frontmatter
    - Simplify body to thin wrapper: argument parsing + skill reference
    - Remove workflow content that now lives in skill (keep orchestrator logic only)
    - Add @-reference to skill: `@~/.claude/skills/kata-planning/SKILL.md`

    **commands/kata/list-phase-assumptions.md:**
    - Add `skills: kata-planning` to frontmatter
    - This is a simple command, keep it minimal but reference the skill

    **agents/kata-planner.md:**
    - Add `skills: kata-planning` to frontmatter (after tools: line)
    - Remove detailed content that now lives in skill
    - Keep only: role description, execution_flow steps (as summary), structured_returns format
    - Agent should be ~200-300 lines (down from ~1400), referencing skill for details

    **agents/kata-plan-checker.md:**
    - Add `skills: kata-planning` to frontmatter
    - Keep checker-specific logic, reference skill for planning context
  </action>
  <verify>
    grep "skills:" commands/kata/plan-phase.md succeeds.
    grep "skills:" agents/kata-planner.md succeeds.
    wc -l agents/kata-planner.md is under 400 lines.
    /kata:plan-phase --help (or dry run) shows same behavior.
  </verify>
  <done>Commands have skills: frontmatter, agents reference skill, content deduplicated.</done>
</task>

<task type="auto">
  <name>Task 3: Update bin/install.js for skills directory</name>
  <files>bin/install.js</files>
  <action>
    Add skills directory copying to bin/install.js.

    After the agents copying section (~line 300-328), add a new section to copy skills:

    ```javascript
    // Copy skills to ~/.claude/skills
    const skillsSrc = path.join(src, 'skills');
    if (fs.existsSync(skillsSrc)) {
      const skillsDest = path.join(claudeDir, 'skills');
      copyWithPathReplacement(skillsSrc, skillsDest, pathPrefix);
      if (verifyInstalled(skillsDest, 'skills')) {
        console.log(`  ${green}âœ“${reset} Installed skills`);
      } else {
        failures.push('skills');
      }
    }
    ```

    This ensures skills/ directory gets installed alongside commands/, kata/, agents/, hooks/.
  </action>
  <verify>
    grep "skills" bin/install.js shows skills copying code.
    node bin/install.js --local succeeds.
    ls .claude/skills/kata-planning/SKILL.md exists after install (only kata-planning skill at this point).
  </verify>
  <done>Install script copies skills directory to .claude/skills/. Partial verification confirms kata-planning skill installs correctly.</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `ls skills/kata-planning/` shows SKILL.md and references/
2. `grep "skills:" commands/kata/plan-phase.md` succeeds
3. `grep "skills:" agents/kata-planner.md` succeeds
4. `node bin/install.js --local` succeeds
5. `ls .claude/skills/kata-planning/` shows skill installed (kata-planning only - other skills created by parallel Wave 1 plans)
</verification>

<success_criteria>
- [ ] kata-planning skill exists with SKILL.md + 5 reference files
- [ ] SKILL.md has trigger-focused description for autonomous invocation
- [ ] plan-phase command has skills: kata-planning in frontmatter
- [ ] kata-planner agent has skills: kata-planning in frontmatter
- [ ] Agent content deduplicated (moved to skill)
- [ ] bin/install.js copies skills directory
- [ ] Local install succeeds and kata-planning skill is accessible
</success_criteria>

<output>
After completion, create `.planning/phases/00-convert-commands-to-skills/00-01-SUMMARY.md`
</output>
