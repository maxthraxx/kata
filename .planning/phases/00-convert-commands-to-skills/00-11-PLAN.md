---
phase: 00-convert-commands-to-skills
plan: 11
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/kata-verification/SKILL.md
  - skills/kata-verification/references/uat-protocol.md
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "kata-verification skill creates UAT.md when verifying work"
    - "kata-verification presents tests one at a time for user verification"
    - "User can run UAT by saying 'test the phase' or 'acceptance test'"
  artifacts:
    - path: "skills/kata-verification/SKILL.md"
      provides: "Complete UAT workflow integrated into verification skill"
      contains: "create_uat_file|present_test|UAT\\.md"
    - path: "skills/kata-verification/references/uat-protocol.md"
      provides: "Detailed UAT execution guidance"
      min_lines: 80
  key_links:
    - from: "skills/kata-verification/SKILL.md"
      to: "skills/kata-verification/references/uat-protocol.md"
      via: "@-reference"
      pattern: "@\\./references/uat-protocol\\.md"
---

<objective>
Fix kata-verification skill to include full UAT workflow with interactive testing.

Purpose: UAT found that kata-verification does automated must_haves verification but never creates UAT.md or presents interactive tests to users. The skill needs to integrate the UAT workflow from verify-work.md.

Output: Updated SKILL.md with complete UAT workflow, plus new reference document for UAT protocol.
</objective>

<execution_context>
@./.claude/kata/workflows/verify-work.md
@./.claude/kata/templates/UAT.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/00-convert-commands-to-skills/00-UAT.md

**Gap being closed:**
```yaml
- truth: "kata-verification creates UAT.md and presents interactive tests"
  status: failed
  reason: "Skill does automated verification but skips UAT creation workflow"
  missing:
    - "Extract testable deliverables from SUMMARY.md"
    - "Create UAT.md with test list"
    - "Present tests one at a time for user verification"
    - "Record pass/issue results interactively"
```
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance existing UAT protocol reference document</name>
  <files>skills/kata-verification/references/uat-protocol.md</files>
  <action>
Review and enhance the EXISTING uat-protocol.md (234 lines) to ensure it includes all UAT execution guidance from verify-work.md.

The file already has:
- UAT.md structure
- Test derivation guidance
- Response processing
- Severity inference table
- Session persistence
- Completion workflow

Check if these elements from verify-work.md are present; add if missing:
1. Test extraction from SUMMARY.md accomplishments section
2. Checkpoint box format for test presentation
3. Stage banners (KATA > USER ACCEPTANCE TESTING)
4. Batch file update rules (when to persist)
5. How to find pending tests for session resumption

If all elements present: No changes needed, proceed to Task 2.
If missing elements: Add them in appropriate sections.
  </action>
  <verify>grep -E "SUMMARY|accomplishment|checkpoint|batch|pending" skills/kata-verification/references/uat-protocol.md returns key concepts</verify>
  <done>Reference document provides complete UAT execution guidance including SUMMARY.md extraction</done>
</task>

<task type="auto">
  <name>Task 2: Add UAT workflow to SKILL.md</name>
  <files>skills/kata-verification/SKILL.md</files>
  <action>
Update SKILL.md to include full UAT workflow. Add after the Goal-Backward Verification section (around line 130):

1. Add mode detection (Step 3) to recognize UAT triggers:
   - "test", "UAT", "acceptance test", "acceptance testing" -> UAT mode
   - "verify", "check", "goal verification" -> goal-backward mode
   - If UAT.md exists and incomplete -> resume UAT mode

2. Add new Step 5: UAT Workflow (model after verify-work.md steps):
```markdown
### Step 5: UAT Workflow

For user acceptance testing:

Display stage banner:
```
KATA > USER ACCEPTANCE TESTING
Loading tests from summaries...
```

**Find SUMMARY.md files:**
```bash
ls "$PHASE_DIR"/*-SUMMARY.md 2>/dev/null
```

**Extract tests from accomplishments:**
Parse each SUMMARY.md for Accomplishments section. For each user-facing deliverable, create test with name and expected behavior.

**Create UAT.md if not exists:**
See `./references/uat-protocol.md` for file format.

Write to `.planning/phases/{phase-dir}/{phase}-UAT.md`

**Present tests one at a time:**
Use checkpoint box format for each test. Wait for user response.

**Process responses:**
- "yes", "pass", "next" -> mark passed
- "skip", "n/a" -> mark skipped
- Anything else -> mark as issue, infer severity

**On completion:**
- Commit UAT.md
- If issues found -> proceed to diagnosis (spawn kata-debugger)
- If all pass -> present success
```

3. Add @-reference to uat-protocol.md in Key References section

4. Update description in frontmatter to include "acceptance test", "UAT", "interactive testing" triggers

5. Add UAT completion to Quality Standards checklist
  </action>
  <verify>grep -E "UAT Workflow|create UAT|present_test|uat-protocol" skills/kata-verification/SKILL.md returns matches</verify>
  <done>Skill includes complete UAT workflow with test presentation and response processing</done>
</task>

</tasks>

<verification>
- [ ] skills/kata-verification/references/uat-protocol.md exists with UAT guidance
- [ ] SKILL.md includes UAT mode detection in Step 3
- [ ] SKILL.md includes Step 5: UAT Workflow with full implementation
- [ ] SKILL.md frontmatter description includes UAT triggers
- [ ] SKILL.md references uat-protocol.md in Key References
</verification>

<success_criteria>
kata-verification skill now:
1. Detects when user wants UAT vs goal-backward verification
2. Extracts testable deliverables from SUMMARY.md
3. Creates UAT.md with proper structure
4. Presents tests one at a time interactively
5. Processes responses and infers severity
6. Triggers diagnosis for issues found
</success_criteria>

<output>
After completion, create `.planning/phases/00-convert-commands-to-skills/00-11-SUMMARY.md`
</output>
