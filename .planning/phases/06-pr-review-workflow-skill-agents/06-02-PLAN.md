---
phase: 06-pr-review-workflow-skill-agents
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/kata-executing-phases/SKILL.md
autonomous: true

must_haves:
  truths:
    - "PR review runs automatically after gh pr ready when pr_workflow=true"
    - "Review is optional and skippable by user"
    - "Review summary included in phase completion output"
    - "Phase execution continues regardless of review outcome"
  artifacts:
    - path: "skills/kata-executing-phases/SKILL.md"
      provides: "Phase execution with PR review integration"
      contains: "kata-reviewing-pull-requests"
  key_links:
    - from: "skills/kata-executing-phases/SKILL.md"
      to: "skills/kata-reviewing-pull-requests/SKILL.md"
      via: "Skill invocation"
      pattern: "reviewing-pull-requests"
---

<objective>
Integrate PR review workflow into kata-executing-phases after gh pr ready (step 10.5).

Purpose: When a phase completes with pr_workflow=true, the PR is marked ready for review. At this point, running automated PR review provides immediate feedback before the user or team reviews the PR manually.

Output: Phase execution that optionally runs PR review after marking PR ready.
</objective>

<execution_context>
@./references/execute-plan.md
@./references/summary-template.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@skills/kata-executing-phases/SKILL.md
@skills/kata-reviewing-pull-requests/SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add PR review step after gh pr ready</name>
  <files>skills/kata-executing-phases/SKILL.md</files>
  <action>
    Modify step 10.5 in kata-executing-phases to add PR review after marking PR ready.

    Current step 10.5 ends with:
    ```bash
    gh pr ready
    PR_URL=$(gh pr view --json url --jq '.url')
    echo "PR marked ready: $PR_URL"
    ```

    After this, add new step 10.6:

    ```
    10.6. **Run PR Review (pr_workflow only, optional)**

        After marking PR ready, offer to run automated review:

        Use AskUserQuestion:
        - header: "PR Review"
        - question: "Run automated PR review before team review?"
        - options:
          - "Yes, run full review" — Run kata-reviewing-pull-requests with all aspects
          - "Quick review (code only)" — Run kata-reviewing-pull-requests with "code" aspect only
          - "Skip" — Proceed without review

        **If user chooses review:**
        1. Invoke skill: `Skill("kata-reviewing-pull-requests", "{review_type}")`
        2. Display review summary
        3. Store REVIEW_SUMMARY for offer_next output

        **If user chooses "Skip":**
        Continue to step 11 without review.

        *Non-blocking: phase completion continues regardless of review findings.*
    ```

    Update `<offer_next>` Route A to include review summary if available:
    - Add line after PR status: `{If REVIEW_SUMMARY: PR Review: {summary_stats}}`

    This integration is intentionally optional and non-blocking:
    - User can skip review entirely
    - Review findings don't block phase completion
    - Results are informational for the subsequent human review
  </action>
  <verify>
    Verify SKILL.md contains:
    - Step 10.6 with PR review workflow
    - AskUserQuestion for review choice
    - Skill invocation of kata-reviewing-pull-requests
    - Updated offer_next with review summary line
  </verify>
  <done>Phase execution skill includes optional PR review after gh pr ready.</done>
</task>

<task type="auto">
  <name>Task 2: Add review agents to model lookup table</name>
  <files>skills/kata-executing-phases/SKILL.md</files>
  <action>
    The skill spawns agents based on model_profile. The PR review skill spawns multiple review agents. Ensure the model lookup table in step 0 includes the review agents.

    Current table includes kata-executor and kata-verifier. Add row for review agents:

    | Agent                | quality | balanced | budget |
    | -------------------- | ------- | -------- | ------ |
    | kata-executor        | opus    | sonnet   | sonnet |
    | kata-verifier        | sonnet  | sonnet   | haiku  |
    | kata-code-reviewer   | opus    | sonnet   | sonnet |
    | kata-*-analyzer      | sonnet  | sonnet   | haiku  |

    Note: The review skill orchestrates its own agents, but this documents the expected model usage for cost planning.

    Also add a note that review agents are spawned by kata-reviewing-pull-requests skill, which handles its own model selection based on the agents' frontmatter.
  </action>
  <verify>
    Verify model lookup table includes review agent entries or note about review skill handling its own model selection.
  </verify>
  <done>Model profile documentation updated to include review workflow context.</done>
</task>

</tasks>

<verification>
- `grep -A 20 "10.6" skills/kata-executing-phases/SKILL.md` — shows PR review step
- `grep "kata-reviewing-pull-requests" skills/kata-executing-phases/SKILL.md` — skill invocation present
- `grep "PR Review" skills/kata-executing-phases/SKILL.md` — AskUserQuestion header present
</verification>

<success_criteria>
- [ ] Step 10.6 added with PR review workflow
- [ ] AskUserQuestion offers review options (full, quick, skip)
- [ ] Skill invocation integrated
- [ ] offer_next updated with review summary
- [ ] Model documentation updated
</success_criteria>

<output>
After completion, create `.planning/phases/06-pr-review-workflow-skill-agents/06-02-SUMMARY.md`
</output>
